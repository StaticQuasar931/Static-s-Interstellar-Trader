<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interstellar Trader</title>
    <style>
        /* ==================== GENERAL STYLES ==================== */
        body {
            background-color: #0b0c10;
            color: #c5c6c7;
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            transition: background-color 0.5s, color 0.5s;
            overflow-x: hidden;
        }
        body.light-theme {
            background-color: #f5f5f5;
            color: #1f2833;
        }
        body.blue-theme {
            background-color: #1e3d59;
            color: #f0f0f0;
        }
        a.header-link {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #66fcf1;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s, background-color 0.3s;
            padding: 8px 12px;
            border-radius: 5px;
            background-color: rgba(102, 252, 241, 0.2);
            font-weight: bold;
            z-index: 1000;
        }
        a.header-link:hover {
            color: #0b0c10;
            background-color: rgba(102, 252, 241, 0.4);
        }
        /* Play Game Here Link */
        a.play-game-link {
            position: absolute;
            top: 10px;
            left: 160px; /* Adjusted to avoid overlap with header-link */
            color: #66fcf1;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s, background-color 0.3s;
            padding: 8px 12px;
            border-radius: 5px;
            background-color: rgba(102, 252, 241, 0.2);
            font-weight: bold;
            z-index: 1000;
        }
        a.play-game-link:hover {
            color: #0b0c10;
            background-color: rgba(102, 252, 241, 0.4);
        }
        .version {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: #c5c6c7;
            font-size: 12px;
            z-index: 1000;
        }
        h1 {
            margin-top: 80px;
            font-size: 48px;
            color: #66fcf1;
        }
        h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #45a29e;
        }

        /* ==================== TOP BUTTONS BAR ==================== */
        .top-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            z-index: 1001;
        }
        .top-buttons button, .top-buttons select {
            background: #1f2833;
            color: #c5c6c7;
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            font-size: 16px;
            font-weight: bold;
            width: 150px;
        }
        .top-buttons button:hover, .top-buttons select:hover {
            background: #45a29e;
            color: #0b0c10;
        }
        .top-buttons select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23c5c6c7" d="M6 9.6L1.8 5.4 2.4 4.8 6 8.4 9.6 4.8 10.2 5.4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
            padding-right: 30px;
        }

        /* ==================== BUY AMOUNT TOGGLE ==================== */
        .buy-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .buy-toggle button {
            background: #45a29e;
            color: #0b0c10;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            font-weight: bold;
            width: 100%;
        }
        .buy-toggle button:hover {
            background: #66fcf1;
            color: #0b0c10;
        }

        /* ==================== SETTINGS, HELP & SHARE BUTTONS ==================== */
        /* Already handled in .top-buttons */

        /* ==================== BUTTON STYLES ==================== */
        .button {
            background-color: #66fcf1;
            color: #0b0c10;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            margin: 5px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            font-weight: bold;
        }
        .button:hover:not(:disabled) {
            background-color: #45a29e;
            color: #ffffff;
        }
        .button:disabled {
            background-color: #c5c6c7;
            color: #1f2833;
            cursor: not-allowed;
        }

        /* ==================== EVENT LOG ==================== */
        .event-log {
            max-width: 800px;
            margin: 20px auto;
            background: #1f2833;
            border-radius: 10px;
            padding: 20px;
            text-align: left;
            height: 200px;
            overflow-y: auto;
            color: #c5c6c7;
            font-size: 14px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .event-log p {
            margin: 5px 0;
        }
        .event-log .important {
            color: red;
        }

        /* ==================== MODAL MENUS ==================== */
        .modal-menu {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1002;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8); /* Black with opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            width: 80%;
            max-width: 800px; /* Increased max-width for wider help menu */
            border-radius: 10px;
            color: #000;
            position: relative;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: background-color 0.5s, color 0.5s;
        }
        .modal-content h3 {
            color: #66fcf1;
            margin-bottom: 10px;
            font-size: 24px;
        }
        body.light-theme .modal-content {
            background-color: #f5f5f5;
            color: #1f2833;
        }
        body.blue-theme .modal-content {
            background-color: #1e3d59;
            color: #f0f0f0;
        }
        .close-modal {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal:hover,
        .close-modal:focus {
            color: black;
            text-decoration: none;
        }

        /* ==================== PROGRESS BAR ==================== */
        .progress-bar {
            width: 100%;
            background-color: #c5c6c7;
            border-radius: 5px;
            margin: 10px 0;
            height: 25px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        body.light-theme .progress-bar {
            background-color: #e0e0e0;
        }
        body.blue-theme .progress-bar {
            background-color: #3b5998;
        }
        .progress {
            height: 100%;
            background-color: green;
            width: 0;
            transition: width 1s ease-in-out;
            position: absolute;
            top: 0;
            left: 0;
        }
        .progress-time, .progress-earnings {
            margin: 0 10px;
            color: #0b0c10;
            font-weight: bold;
            font-size: 14px;
            z-index: 1;
        }
        .progress-earnings {
            margin-left: auto;
        }

        /* ==================== SHIP MODULE ==================== */
        .ship {
            background: #0b0c10;
            border: 2px solid #66fcf1;
            border-radius: 10px;
            padding: 10px;
            width: 220px;
            position: relative;
            box-shadow: 0 0 10px rgba(102,252,241,0.5);
            margin: 10px;
            cursor: pointer;
            flex-shrink: 0;
            transition: transform 0.3s, background-color 0.5s, border-color 0.5s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        body.light-theme .ship {
            background: #ffffff;
            border: 2px solid #66fcf1;
        }
        body.blue-theme .ship {
            background: #1e3d59;
            border: 2px solid #f0f0f0;
        }
        .ship:hover {
            transform: scale(1.05);
        }
        .ship p {
            margin: 5px 0;
            color: #66fcf1;
            font-size: 14px;
        }
        body.light-theme .ship p {
            color: #45a29e;
        }
        body.blue-theme .ship p {
            color: #f0f0f0;
        }
        .ship button {
            margin-top: 10px;
            width: 100%;
            padding: 5px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 5px;
        }
        .upgrade-count {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ffb703;
            color: #0b0c10;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        .upgrade-count:hover {
            background: #e0a800;
        }

        /* ==================== AUTOMATION INDICATOR ==================== */
        .automation-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #00ff00;
            font-size: 18px;
            display: none;
            cursor: default;
        }
        .ship.automation .automation-indicator {
            display: block;
        }

        /* ==================== SHIP CONTAINER ==================== */
        .ship-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 1200px) {
            .ship {
                width: 45%;
            }
        }
        @media (max-width: 768px) {
            .ship {
                width: 90%;
            }
            .top-buttons {
                flex-direction: column;
                align-items: flex-end;
                gap: 10px;
            }
            .progress-bar {
                height: 20px;
            }
        }

        /* ==================== HIGHLIGHTED CREDITS ==================== */
        #credits {
            font-size: 24px;
            font-weight: bold;
            color: #66fcf1;
            transition: color 0.5s;
        }
        body.light-theme #credits {
            color: #45a29e;
        }
        body.blue-theme #credits {
            color: #f0f0f0;
        }

        /* ==================== SPACESHIP CAP DISPLAY ==================== */
        #spaceship-display {
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
            color: #c5c6c7;
            transition: color 0.5s;
        }
        body.light-theme #spaceship-display {
            color: #1f2833;
        }
        body.blue-theme #spaceship-display {
            color: #f0f0f0;
        }

        /* ==================== TECH LEVEL DISPLAY ==================== */
        #tech-level-display {
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
            color: #c5c6c7;
            transition: color 0.5s;
        }
        body.light-theme #tech-level-display {
            color: #1f2833;
        }
        body.blue-theme #tech-level-display {
            color: #f0f0f0;
        }
    </style>
</head>
<body>
    <!-- Header Links -->
    <a href="https://sites.google.com/view/staticquasar931" class="header-link" data-localize="madeBy">Made By Static</a>

    <!-- Play Game Here Link -->
    <a href="https://sites.google.com/view/staticquasar931/static-gmes/interstellar-trader" class="header-link play-game-link" data-localize="playGameHere">Play Game Here</a>

    <!-- Top Buttons Bar -->
    <div class="top-buttons">
        <button class="button share-button" onclick="shareGame()" title="Share the game and earn a bonus" data-localize="shareGame">🔗 Share Game</button>
        <button class="button buy-toggle" onclick="toggleBuyAmount()" title="Change Buy Amount" data-localize="buyAmount">Buy: 1x</button>
        <button class="button help-button" onclick="toggleHelp()" title="Open Help" data-localize="help">❓ Help</button>
        <button class="button settings-button" onclick="toggleSettings()" title="Open Settings" data-localize="settings">⚙️ Settings</button>
    </div>

    <!-- Main Titles -->
    <h1>✨ Interstellar Trader ✨</h1>
    <h2>Your goal: Build an intergalactic trading empire!</h2>

    <!-- Game Area -->
    <div id="game-area">
        <p id="credits" data-localize="credits">100 💸</p>
        <p id="spaceship-display" data-localize="spaceshipDisplay">Spaceships: 1/10 🚀</p>
        <p id="tech-level-display" data-localize="techLevelDisplay"><strong>Technology Level:</strong> 1 ✯</p>
        <div class="action-buttons">
            <button class="button" onclick="sendAllShips()" title="Send all ships to trade and earn credits" data-localize="sendAllShips">⚙️ Send All Ships to Trade</button>
            <button class="button" onclick="buyShip()" title="Purchase a new spaceship" data-localize="buyNewShip">⚖️ Buy a New Ship</button>
            <button class="button" onclick="buyUpgrade()" title="Purchase upgrades to increase your technology level" data-localize="buyUpgrade">✚ Buy Upgrade</button>
            <button class="button" onclick="upgradeAll()" title="Upgrade all ships based on the selected buy amount" data-localize="upgradeAll">🔼 Upgrade All</button>
            <button class="button" onclick="toggleUpgradeMenu()" title="Open the Upgrade Menu" data-localize="upgradeMenu">🔧 Upgrade Menu</button>
            <button class="button" onclick="toggleRebirthMenu()" title="Open the Rebirth Menu" data-localize="rebirthMenu">♻️ Rebirth Menu</button>
        </div>
        <div id="event-log" class="event-log">
            <p>Game log:</p>
        </div>
    </div>

    <!-- Spaceship Progress Area -->
    <div id="ship-area">
        <h3>Spaceship Fleet</h3>
        <div class="ship-container" id="ship-container"></div>
    </div>

    <!-- Version Number -->
    <div class="version" id="version-number">v1.62.08</div>

    <!-- Modals -->
    <!-- Upgrade Menu Modal -->
    <div id="upgrade-menu" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="upgrade-menu-title">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleUpgradeMenu()">&times;</span>
            <h3 id="upgrade-menu-title" data-localize="upgradeMenuTitle">Upgrade Menu</h3>
            <div>
                <h4>General Upgrades</h4>
                <button class="button" onclick="buyAutomation()" title="Unlock automation to send ships automatically" data-localize="buyAutomation">🤖 Buy Automation</button>
                <button class="button" onclick="buyMultiplier()" title="Increase your technology level multiplier" data-localize="buyMultiplier">✖️ Buy Multiplier</button>
            </div>
            <div style="margin-top: 20px;">
                <h4>Employee Hiring</h4>
                <button class="button" onclick="hireEmployee('storage')" title="Hire a Storage Employee" data-localize="hireStorage">📦 Hire Storage Employee (Over Time)</button>
                <button class="button" onclick="hireEmployee('efficiency')" title="Hire an Efficiency Employee" data-localize="hireEfficiency">⚙️ Hire Efficiency Employee (One-Time)</button>
                <button class="button" onclick="hireEmployee('security')" title="Hire a Security Employee" data-localize="hireSecurity">🛡️ Hire Security Employee (One-Time)</button>
            </div>
        </div>
    </div>

    <!-- Rebirth Menu Modal -->
    <div id="rebirth-menu" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="rebirth-menu-title">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleRebirthMenu()">&times;</span>
            <h3 id="rebirth-menu-title" data-localize="rebirthMenuTitle">Rebirth Menu</h3>
            <p data-localize="rebirthPoints">Rebirth Points (RP): <span id="rebirth-points">0</span> 🔄</p>
            <button class="button" onclick="confirmRebirth()" title="Rebirth to reset progress and earn RP" data-localize="rebirthButton">♻️ Rebirth (Requires 100K Credits)</button>
            <button class="button" onclick="spendRebirthPoints()" title="Spend RP to enhance your empire" data-localize="spendRPButton">🔧 Spend RP for Upgrades</button>
            <p class="important" id="rebirth-info"></p>
        </div>
    </div>

    <!-- Help Menu Modal -->
    <div id="help-menu" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="help-menu-title">
        <div class="modal-content" style="width: 90%; max-width: 800px;">
            <span class="close-modal" onclick="toggleHelp()">&times;</span>
            <h3 id="help-menu-title" data-localize="helpMenuTitle">Help</h3>
            <div>
                <h4 data-localize="tutorialTitle">Tutorial: How to Play</h4>
                <p data-localize="tutorialContent">Welcome to Interstellar Trader! 🚀 Your objective is to build an intergalactic trading empire by sending your ships to trade goods between planets. Here's how to get started:</p>
                <ul>
                    <li><strong>Send All Ships to Trade (⚙️):</strong> Initiate trade missions for all available ships simultaneously.</li>
                    <li><strong>Buy a New Ship (⚖️):</strong> Purchase additional ships to expand your trading fleet.</li>
                    <li><strong>Buy Upgrade (✚):</strong> Enhance your technology level, increasing earnings per trade.</li>
                    <li><strong>Upgrade All (🔼):</strong> Upgrade all ships based on the selected buy amount, prioritizing cheaper upgrades first.</li>
                    <li><strong>Upgrade Menu (🔧):</strong> Access various upgrade options including Automation, Multiplier, Employee Hiring.</li>
                    <li><strong>Rebirth Menu (♻️):</strong> Reset your progress to earn Rebirth Points, which can be used for significant upgrades.</li>
                </ul>
            </div>
            <div style="margin-top: 20px;">
                <h4 data-localize="gameInfoTitle">Game Information</h4>
                <p data-localize="gameInfoContent"><strong>Credits:</strong> Your in-game currency used to purchase ships, upgrades, and other features.<br>
                <strong>Technology Level:</strong> Determines the efficiency and earnings of your trading operations.<br>
                <strong>Rebirth Points (RP):</strong> Earned through rebirths, used to purchase powerful upgrades.</p>
            </div>
            <div style="margin-top: 20px;">
                <h4 data-localize="gameTipsTitle">Game Tips</h4>
                <ul>
                    <li data-localize="gameTip1">Use the Buy Amount toggle to purchase multiple upgrades at once for faster progression.</li>
                    <li data-localize="gameTip2">Automate trading to continuously earn credits even when you're not actively playing.</li>
                    <li data-localize="gameTip3">Strategically rebirth to maximize your RP and accelerate growth.</li>
                    <li data-localize="gameTip4">Upgrade your traders to increase earnings per trade.</li>
                    <li data-localize="gameTip5">Hire employees to unlock new functionalities and enhance your fleet.</li>
                    <li data-localize="gameTip6">Share the game on multiple platforms to earn bonuses and help grow your trading empire.</li>
                </ul>
            </div>
            <div style="margin-top: 20px;">
                <h4 data-localize="upgradeCostsTitle">Upgrade Costs</h4>
                <ul>
                    <li data-localize="upgradeCost1"><strong>Automation:</strong> Cost increases by 1.2x with each level.</li>
                    <li data-localize="upgradeCost2"><strong>Multiplier:</strong> Cost increases by 1.5x with each level.</li>
                    <li data-localize="upgradeCost3"><strong>Employees:</strong> Cost increases by 1.2x with each level.</li>
                </ul>
            </div>
            <button class="button" onclick="toggleHelp()" title="Close Help" data-localize="closeHelp">❌ Close</button>
        </div>
    </div>

    <!-- Settings Menu Modal -->
    <div id="settings-menu" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="settings-menu-title">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleSettings()">&times;</span>
            <h3 id="settings-menu-title" data-localize="settingsMenuTitle">Settings</h3>
            <button class="button" onclick="toggleTheme()" title="Toggle Theme" data-localize="toggleTheme">🌙 Toggle Theme</button>
            <button class="button" onclick="saveGameManually()" title="Manually Save Game" data-localize="saveGame">💾 Save Game</button>
            <button class="button" onclick="resetGame()" title="Reset Game" data-localize="resetGame">🗑️ Reset Game</button>
            <div style="margin-top: 20px;">
                <h4>Select Language</h4>
                <select onchange="changeLanguage(this.value)">
                    <option value="en">English</option>
                    <option value="es">Español</option>
                    <option value="nl">Nederlands</option>
                    <option value="vi">Tiếng Việt</option>
                </select>
            </div>
            <p id="rebirth-info" class="important"></p>
        </div>
    </div>

    <!-- Rebirth Confirmation Modal -->
    <div id="rebirth-modal-confirm" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="rebirth-modal-confirm-title">
        <div class="modal-content">
            <span class="close-modal" onclick="closeRebirthModal()">&times;</span>
            <h3 id="rebirth-modal-confirm-title" data-localize="confirmRebirthTitle">Confirm Rebirth</h3>
            <p data-localize="confirmRebirthText">Are you sure you want to rebirth? This will reset all your progress but grant you <strong>{points}</strong> Rebirth Points (RP).</p>
            <button class="button" onclick="rebirth()" title="Confirm Rebirth" data-localize="confirmRebirth">✅ Confirm</button>
            <button class="button" onclick="closeRebirthModal()" title="Cancel Rebirth" data-localize="cancelRebirth">❌ Cancel</button>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="reset-modal" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="reset-modal-title">
        <div class="modal-content">
            <span class="close-modal" onclick="closeResetModal()">&times;</span>
            <h3 id="reset-modal-title" data-localize="confirmResetTitle">Confirm Reset</h3>
            <p data-localize="confirmResetText">Are you sure you want to reset the game? This action cannot be undone.</p>
            <button class="button" onclick="performReset()" title="Confirm Reset" data-localize="confirmReset">✅ Confirm</button>
            <button class="button" onclick="closeResetModal()" title="Cancel Reset" data-localize="cancelReset">❌ Cancel</button>
        </div>
    </div>

    <!-- Share Confirmation Modal -->
    <div id="share-confirm-modal" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="share-confirm-modal-title">
        <div class="modal-content">
            <span class="close-modal" onclick="closeShareConfirmModal()">&times;</span>
            <h3 id="share-confirm-modal-title" data-localize="shareConfirmationTitle">Share the Game</h3>
            <p data-localize="shareConfirmationText">Share this link on your favorite platform to earn a bonus!</p>
            <div style="margin-bottom: 10px;">
                <a href="https://twitter.com/intent/tweet?text=Join%20me%20in%20Interstellar%20Trader%20and%20build%20your%20own%20intergalactic%20trading%20empire!%20https://sites.google.com/view/staticquasar931/static-gmes/interstellar-trader" target="_blank" class="button" style="background-color: #1da1f2; margin-right: 5px;">🐦 Share on Twitter</a>
                <a href="https://www.facebook.com/sharer/sharer.php?u=https://sites.google.com/view/staticquasar931/static-gmes/interstellar-trader" target="_blank" class="button" style="background-color: #4267B2; margin-right: 5px;">📘 Share on Facebook</a>
                <a href="https://www.reddit.com/submit?url=https://sites.google.com/view/staticquasar931/static-gmes/interstellar-trader&title=Interstellar%20Trader%20-%20Build%20your%20intergalactic%20trading%20empire" target="_blank" class="button" style="background-color: #FF4500; margin-right: 5px;">👽 Share on Reddit</a>
                <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://sites.google.com/view/staticquasar931/static-gmes/interstellar-trader&title=Interstellar%20Trader&summary=Build%20your%20intergalactic%20trading%20empire!" target="_blank" class="button" style="background-color: #0077B5;">🔗 Share on LinkedIn</a>
            </div>
            <p data-localize="shareOrCopy">Or copy the link below:</p>
            <input type="text" id="share-link" value="https://sites.google.com/view/staticquasar931/static-gmes/interstellar-trader" readonly style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <button class="button" onclick="copyShareLink()" title="Copy Share Link" data-localize="copyLink">📋 Copy Link</button>
            <button class="button" onclick="closeShareConfirmModal()" title="Cancel Share" data-localize="cancelShare">❌ Cancel</button>
        </div>
    </div>

    <!-- Achievement Modal -->
    <div id="achievement-modal" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="achievement-modal-title">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAchievementModal()">&times;</span>
            <h3 id="achievement-modal-title" data-localize="achievementTitle">Achievement Unlocked!</h3>
            <p id="achievement-message" data-localize="achievementMessage">You have unlocked a new achievement.</p>
            <button class="button" onclick="closeAchievementModal()" title="Close Achievement" data-localize="closeAchievement">❌ Close</button>
        </div>
    </div>

    <script>
        // ==================== LOCALIZATION ====================
        const localization = {
            "en": {
                "madeBy": "Made By Static",
                "playGameHere": "Play Game Here",
                "shareGame": "🔗 Share Game",
                "buyAmount": "Buy: 1x",
                "help": "❓ Help",
                "settings": "⚙️ Settings",
                "credits": "Credits",
                "spaceshipDisplay": "Spaceships: 1/10 🚀",
                "techLevelDisplay": "Technology Level: 1 ✯",
                "sendAllShips": "⚙️ Send All Ships to Trade",
                "buyNewShip": "⚖️ Buy a New Ship",
                "buyUpgrade": "✚ Buy Upgrade",
                "upgradeAll": "🔼 Upgrade All",
                "upgradeMenu": "🔧 Upgrade Menu",
                "rebirthMenu": "♻️ Rebirth Menu",
                "rebirthPoints": "Rebirth Points (RP):",
                "rebirthButton": "♻️ Rebirth (Requires 100K Credits)",
                "spendRPButton": "🔧 Spend RP for Upgrades",
                "rebirthInfo": "",
                "confirmRebirth": "✅ Confirm",
                "cancelRebirth": "❌ Cancel",
                "resetGame": "🗑️ Reset Game",
                "confirmReset": "✅ Confirm",
                "cancelReset": "❌ Cancel",
                "shareConfirmationTitle": "Share the Game",
                "shareConfirmationText": "Share this link on your favorite platform to earn a bonus!",
                "copyLink": "📋 Copy Link",
                "cancelShare": "❌ Cancel",
                "tutorialTitle": "Tutorial: How to Play",
                "tutorialContent": "Welcome to Interstellar Trader! 🚀 Your objective is to build an intergalactic trading empire by sending your ships to trade goods between planets. Here's how to get started:",
                "gameInfoTitle": "Game Information",
                "gameInfoContent": "Credits: Your in-game currency used to purchase ships, upgrades, and other features.\nTechnology Level: Determines the efficiency and earnings of your trading operations.\nRebirth Points (RP): Earned through rebirths, used to purchase powerful upgrades.",
                "gameTipsTitle": "Game Tips",
                "gameTip1": "Use the Buy Amount toggle to purchase multiple upgrades at once for faster progression.",
                "gameTip2": "Automate trading to continuously earn credits even when you're not actively playing.",
                "gameTip3": "Strategically rebirth to maximize your RP and accelerate growth.",
                "gameTip4": "Upgrade your traders to increase earnings per trade.",
                "gameTip5": "Hire employees to unlock new functionalities and enhance your fleet.",
                "gameTip6": "Share the game on multiple platforms to earn bonuses and help grow your trading empire.",
                "upgradeCostsTitle": "Upgrade Costs",
                "upgradeCost1": "Automation: Cost increases by 1.2x with each level.",
                "upgradeCost2": "Multiplier: Cost increases by 1.5x with each level.",
                "upgradeCost3": "Employees: Cost increases by 1.2x with each level.",
                "closeHelp": "❌ Close",
                "hireStorage": "📦 Hire Storage Employee (Over Time)",
                "hireEfficiency": "⚙️ Hire Efficiency Employee (One-Time)",
                "hireSecurity": "🛡️ Hire Security Employee (One-Time)",
                "confirmRebirthTitle": "Confirm Rebirth",
                "confirmRebirthText": "Are you sure you want to rebirth? This will reset all your progress but grant you <strong>{points}</strong> Rebirth Points (RP).",
                "confirmResetTitle": "Confirm Reset",
                "confirmResetText": "Are you sure you want to reset the game? This action cannot be undone.",
                "rebirthSuccess": "♻️ You have rebirthed! Earned {points} Rebirth Points.",
                "rebirthCooldown": "⚠ Rebirth is on cooldown. Please wait {time} before rebirthing again.",
                "rebirthNotEnough": "⚠ Not enough credits to rebirth! (Requires {cost} Credits)",
                "rebirthInfoText": "Next Rebirth in: {time}",
                "upgradeMenuTitle": "Upgrade Menu",
                "buyAutomation": "🤖 Buy Automation (Cost: {cost} Credits)",
                "buyMultiplier": "✖️ Buy Multiplier (Cost: {cost} Credits)",
                "hireEmployee": "👨‍🚀 Hire {type} Employee (Cost: {cost} Credits)",
                "upgradeTrader": "Upgrade Trader (Cost: {cost} Credits)",
                "upgradeTraderMax": "Upgrade Trader to Max (Cost: {cost} Credits)",
                "upgradeAllButton": "🔼 Upgrade All",
                "sendAllShipsButton": "⚙️ Send All Ships to Trade",
                "buyNewShipButton": "⚖️ Buy a New Ship",
                "buyUpgradeButton": "✚ Buy Upgrade",
                "rebirthButtonTitle": "♻️ Rebirth (Requires 100K Credits)",
                "spendRPButtonTitle": "🔧 Spend RP for Upgrades",
                "rebirthPointsDisplay": "{points} RP",
                "resetButton": "🗑️ Reset Game",
                "resetConfirmation": "Are you sure you want to reset the game? This action cannot be undone.",
                "tradeCompleted": "✨ Ship {shipId} completed a trade mission and earned {earnings} credits!",
                "buyShipCost": "⚠ Not enough credits to buy a new ship! (Cost: {cost} Credits)",
                "buyUpgradeSuccess": "✚ Bought upgrade x{multiplier}! Tech level increased to {techLevel}.",
                "buyUpgradeFail": "⚠ Not enough credits to buy upgrade!",
                "hireEmployeeSuccess": "👨‍🚀 Hired a Level {level} {type} Employee!",
                "hireEmployeeFail": "⚠ Not enough credits to hire {type} employee! (Cost: {cost} Credits)",
                "buyAutomationSuccess": "🤖 Automation purchased for Ship {shipId}!",
                "buyAutomationFail": "⚠ Not enough credits to buy automation! (Cost: {cost} Credits)",
                "buyMultiplierSuccess": "✖️ Multiplier purchased! Technology multiplier increased to x{multiplier}.",
                "buyMultiplierFail": "⚠ Not enough credits to buy multiplier! (Cost: {cost} Credits)",
                "shareSuccess": "📋 Game link copied to clipboard! You earned a 500 Credits bonus.",
                "shareFail": "⚠ Failed to copy the game link.",
                "combineShipsRemoved": "🔗 Combine Ships feature has been removed.",
                "shipLimitUpgradeSuccess": "📈 Ship limit upgraded! New limit: {newLimit} ships.",
                "shipLimitUpgradeFail": "⚠ Not enough credits to upgrade ship limit! (Cost: {cost} Credits)",
                "tradeAlreadyActive": "⚙️ Ship {shipId} is already trading.",
                "upgradeTraderSuccess": "🔼 Ship {shipId} trader level increased by x{upgrades} to {traderLevel}.",
                "upgradeTraderFail": "⚠ Not enough credits to upgrade trader for Ship {shipId}! (Cost: {cost} Credits)",
                "randomEventAlienAttack": "💥 An alien attack! You lost 50 credits to defend yourself.",
                "randomEventAlienAttackProtected": "🛡️ Security Employee protected you from an alien attack! No credits lost.",
                "randomEventMeteorShower": "☄️✨ Meteor shower! Your ships earned a bonus of 25 credits per trade.",
                "randomEventMeteorShowerBonus": "✨ Bonus: Earned an extra {bonus} credits from meteor shower.",
                "randomEventGalacticFair": "🎉 Galactic fair! You made a deal and earned 100 bonus credits.",
                "rebirthCooldownInfo": "Next Rebirth in: {time}",
                "tradeDuration": "{duration}s",
                "tradeEarnings": "{earnings} 💸",
                "upgradeButtonTitle": "Enhance trader efficiency",
                "sendAllShipsTitle": "Send all ships to trade and earn credits",
                "buyNewShipTitle": "Purchase a new spaceship",
                "buyUpgradeTitle": "Purchase upgrades to increase your technology level",
                "upgradeAllTitle": "Upgrade all ships based on the selected buy amount",
                "upgradeMenuTitleModal": "Open the Upgrade Menu",
                "rebirthMenuTitleModal": "Open the Rebirth Menu",
                "buyAutomationTitle": "Unlock automation to send ships automatically",
                "buyMultiplierTitle": "Increase your technology level multiplier",
                "hireEmployeeTitle": "Hire specific types of employees",
                "shareGameTitle": "Share the game and earn a bonus",
                "closeHelp": "❌ Close",
                "openHelp": "❓ Help",
                "openSettings": "⚙️ Settings",
                "openRebirthMenu": "♻️ Rebirth Menu",
                "openUpgradeMenu": "🔧 Upgrade Menu",
                "achievementTitle": "Achievement Unlocked!",
                "achievementMessage": "You have unlocked a new achievement.",
                "toggleTheme": "🌙 Toggle Theme",
                "saveGame": "💾 Save Game",
                "shareOrCopy": "Or copy the link below:",
                "closeAchievement": "❌ Close"
            },
            "es": {
                "madeBy": "Hecho por Static",
                "playGameHere": "Juega Aquí",
                "shareGame": "🔗 Compartir Juego",
                "buyAmount": "Comprar: 1x",
                "help": "❓ Ayuda",
                "settings": "⚙️ Configuración",
                "credits": "Créditos",
                "spaceshipDisplay": "Naves: 1/10 🚀",
                "techLevelDisplay": "Nivel de Tecnología: 1 ✯",
                "sendAllShips": "⚙️ Enviar Todas las Naves a Comerciar",
                "buyNewShip": "⚖️ Comprar una Nueva Nave",
                "buyUpgrade": "✚ Comprar Mejora",
                "upgradeAll": "🔼 Mejorar Todas",
                "upgradeMenu": "🔧 Menú de Mejoras",
                "rebirthMenu": "♻️ Menú de Renacimiento",
                "rebirthPoints": "Puntos de Renacimiento (RP):",
                "rebirthButton": "♻️ Renacimiento (Requiere 100K Créditos)",
                "spendRPButton": "🔧 Gastar RP para Mejoras",
                "rebirthInfo": "",
                "confirmRebirth": "✅ Confirmar",
                "cancelRebirth": "❌ Cancelar",
                "resetGame": "🗑️ Reiniciar Juego",
                "confirmReset": "✅ Confirmar",
                "cancelReset": "❌ Cancelar",
                "shareConfirmationTitle": "Compartir el Juego",
                "shareConfirmationText": "¡Comparte este enlace en tu plataforma favorita para ganar un bono!",
                "copyLink": "📋 Copiar Enlace",
                "cancelShare": "❌ Cancelar",
                "tutorialTitle": "Tutorial: Cómo Jugar",
                "tutorialContent": "¡Bienvenido a Interstellar Trader! 🚀 Tu objetivo es construir un imperio comercial intergaláctico enviando tus naves a comerciar mercancías entre planetas. Así es como comenzar:",
                "gameInfoTitle": "Información del Juego",
                "gameInfoContent": "Créditos: Tu moneda en el juego usada para comprar naves, mejoras y otras características.<br>Nivel de Tecnología: Determina la eficiencia y ganancias de tus operaciones comerciales.<br>Puntos de Renacimiento (RP): Ganados a través de renacimientos, usados para comprar mejoras poderosas.",
                "gameTipsTitle": "Consejos del Juego",
                "gameTip1": "Usa el interruptor de Cantidad de Compra para comprar múltiples mejoras a la vez y progresar más rápido.",
                "gameTip2": "Automatiza el comercio para ganar créditos continuamente incluso cuando no estás jugando activamente.",
                "gameTip3": "Renace estratégicamente para maximizar tus RP y acelerar el crecimiento.",
                "gameTip4": "Mejora tus comerciantes para aumentar las ganancias por comercio.",
                "gameTip5": "Contrata empleados para desbloquear nuevas funcionalidades y mejorar tu flota.",
                "gameTip6": "Comparte el juego en múltiples plataformas para ganar bonificaciones y ayudar a crecer tu imperio comercial.",
                "upgradeCostsTitle": "Costos de Mejoras",
                "upgradeCost1": "Automatización: El costo aumenta 1.2x con cada nivel.",
                "upgradeCost2": "Multiplicador: El costo aumenta 1.5x con cada nivel.",
                "upgradeCost3": "Empleados: El costo aumenta 1.2x con cada nivel.",
                "closeHelp": "❌ Cerrar",
                "hireStorage": "📦 Contratar Empleado de Almacenamiento (En Tiempo)",
                "hireEfficiency": "⚙️ Contratar Empleado de Eficiencia (Único)",
                "hireSecurity": "🛡️ Contratar Empleado de Seguridad (Único)",
                "confirmRebirthTitle": "Confirmar Renacimiento",
                "confirmRebirthText": "¿Estás seguro de que deseas renacer? Esto reiniciará todo tu progreso pero te otorgará <strong>{points}</strong> Puntos de Renacimiento (RP).",
                "confirmResetTitle": "Confirmar Reinicio",
                "confirmResetText": "¿Estás seguro de que deseas reiniciar el juego? Esta acción no se puede deshacer.",
                "rebirthSuccess": "♻️ ¡Has renacido! Ganaste {points} Puntos de Renacimiento.",
                "rebirthCooldown": "⚠ El renacimiento está en enfriamiento. Por favor espera {time} antes de renacer nuevamente.",
                "rebirthNotEnough": "⚠ ¡No tienes suficientes créditos para renacer! (Requiere {cost} Créditos)",
                "rebirthInfoText": "Próximo Renacimiento en: {time}",
                "upgradeMenuTitle": "Menú de Mejoras",
                "buyAutomation": "🤖 Comprar Automatización (Costo: {cost} Créditos)",
                "buyMultiplier": "✖️ Comprar Multiplicador (Costo: {cost} Créditos)",
                "hireEmployee": "👨‍🚀 Contratar Empleado de {type} (Costo: {cost} Créditos)",
                "upgradeTrader": "Mejorar Comerciante (Costo: {cost} Créditos)",
                "upgradeTraderMax": "Mejorar Comerciante al Máximo (Costo: {cost} Créditos)",
                "upgradeAllButton": "🔼 Mejorar Todas",
                "sendAllShipsButton": "⚙️ Enviar Todas las Naves a Comerciar",
                "buyNewShipButton": "⚖️ Comprar una Nueva Nave",
                "buyUpgradeButton": "✚ Comprar Mejora",
                "rebirthButtonTitle": "♻️ Renacimiento (Requiere 100K Créditos)",
                "spendRPButtonTitle": "🔧 Gastar RP para Mejoras",
                "rebirthPointsDisplay": "{points} RP",
                "resetButton": "🗑️ Reiniciar Juego",
                "resetConfirmation": "¿Estás seguro de que deseas reiniciar el juego? Esta acción no se puede deshacer.",
                "tradeCompleted": "✨ La Nave {shipId} completó una misión de comercio y ganó {earnings} créditos!",
                "buyShipCost": "⚠ ¡No tienes suficientes créditos para comprar una nueva nave! (Costo: {cost} Créditos)",
                "buyUpgradeSuccess": "✚ ¡Compraste mejora x{multiplier}! Nivel de tecnología aumentado a {techLevel}.",
                "buyUpgradeFail": "⚠ ¡No tienes suficientes créditos para comprar mejora!",
                "hireEmployeeSuccess": "👨‍🚀 ¡Contrataste a un Empleado de {type} Nivel {level}!",
                "hireEmployeeFail": "⚠ ¡No tienes suficientes créditos para contratar a un empleado de {type}! (Costo: {cost} Créditos)",
                "buyAutomationSuccess": "🤖 ¡Automatización comprada para la Nave {shipId}!",
                "buyAutomationFail": "⚠ ¡No tienes suficientes créditos para comprar automatización! (Costo: {cost} Créditos)",
                "buyMultiplierSuccess": "✖️ ¡Multiplicador comprado! Multiplicador de tecnología aumentado a x{multiplier}.",
                "buyMultiplierFail": "⚠ ¡No tienes suficientes créditos para comprar multiplicador! (Costo: {cost} Créditos)",
                "shareSuccess": "📋 ¡Enlace del juego copiado al portapapeles! Ganaste un bono de 500 Créditos.",
                "shareFail": "⚠ Falló al copiar el enlace del juego.",
                "combineShipsRemoved": "🔗 La función de Combinar Naves ha sido eliminada.",
                "shipLimitUpgradeSuccess": "📈 ¡Límite de naves aumentado! Nuevo límite: {newLimit} naves.",
                "shipLimitUpgradeFail": "⚠ ¡No tienes suficientes créditos para aumentar el límite de naves! (Costo: {cost} Créditos)",
                "tradeAlreadyActive": "⚙️ ¡La Nave {shipId} ya está comerciando!",
                "upgradeTraderSuccess": "🔼 ¡Nivel de comerciante de la Nave {shipId} aumentado en x{upgrades} a {traderLevel}.",
                "upgradeTraderFail": "⚠ ¡No tienes suficientes créditos para mejorar comerciante de la Nave {shipId}! (Costo: {cost} Créditos)",
                "randomEventAlienAttack": "💥 ¡Un ataque alienígena! Perdiste 50 créditos para defenderte.",
                "randomEventAlienAttackProtected": "🛡️ ¡Empleado de Seguridad protegió tu nave de un ataque alienígena! No se perdieron créditos.",
                "randomEventMeteorShower": "☄️✨ ¡Lluvia de meteoros! Tus naves ganaron un bono de 25 créditos por comercio.",
                "randomEventMeteorShowerBonus": "✨ Bono: Ganaste un extra de {bonus} créditos por lluvia de meteoros.",
                "randomEventGalacticFair": "🎉 ¡Feria galáctica! Hiciste un trato y ganaste 100 créditos de bonificación.",
                "rebirthCooldownInfo": "Próximo Renacimiento en: {time}",
                "tradeDuration": "{duration}s",
                "tradeEarnings": "{earnings} 💸",
                "upgradeButtonTitle": "Mejorar eficiencia del comerciante",
                "sendAllShipsTitle": "Enviar todas las naves a comerciar y ganar créditos",
                "buyNewShipTitle": "Comprar una nueva nave espacial",
                "buyUpgradeTitle": "Comprar mejoras para aumentar tu nivel de tecnología",
                "upgradeAllTitle": "Mejorar todas las naves según la cantidad de compra seleccionada",
                "upgradeMenuTitleModal": "Abrir el Menú de Mejoras",
                "rebirthMenuTitleModal": "Abrir el Menú de Renacimiento",
                "buyAutomationTitle": "Desbloquear automatización para enviar naves automáticamente",
                "buyMultiplierTitle": "Aumentar tu multiplicador de nivel de tecnología",
                "hireEmployeeTitle": "Contratar tipos específicos de empleados",
                "shareGameTitle": "Compartir el juego y ganar un bono",
                "closeHelp": "❌ Cerrar",
                "openHelp": "❓ Ayuda",
                "openSettings": "⚙️ Configuración",
                "openRebirthMenu": "♻️ Menú de Renacimiento",
                "openUpgradeMenu": "🔧 Menú de Mejoras",
                "achievementTitle": "¡Logro Desbloqueado!",
                "achievementMessage": "Has desbloqueado un nuevo logro.",
                "toggleTheme": "🌙 Cambiar Tema",
                "saveGame": "💾 Guardar Juego",
                "shareOrCopy": "O copia el enlace a continuación:",
                "closeAchievement": "❌ Cerrar"
            },
            "nl": {
                "madeBy": "Gemaakt door Static",
                "playGameHere": "Speel Hier",
                "shareGame": "🔗 Deel Spel",
                "buyAmount": "Kopen: 1x",
                "help": "❓ Help",
                "settings": "⚙️ Instellingen",
                "credits": "Credits",
                "spaceshipDisplay": "Ruimteschepen: 1/10 🚀",
                "techLevelDisplay": "Technologieniveau: 1 ✯",
                "sendAllShips": "⚙️ Verstuur Alle Ruimteschepen om te Handelen",
                "buyNewShip": "⚖️ Koop een Nieuw Ruimteschip",
                "buyUpgrade": "✚ Koop Upgrade",
                "upgradeAll": "🔼 Upgrade Alles",
                "upgradeMenu": "🔧 Upgrade Menu",
                "rebirthMenu": "♻️ Hergeboorte Menu",
                "rebirthPoints": "Punten Hergeboorte (RP):",
                "rebirthButton": "♻️ Hergeboorte (Vereist 100K Credits)",
                "spendRPButton": "🔧 Gebruik RP voor Upgrades",
                "rebirthInfo": "",
                "confirmRebirth": "✅ Bevestigen",
                "cancelRebirth": "❌ Annuleren",
                "resetGame": "🗑️ Reset Spel",
                "confirmReset": "✅ Bevestigen",
                "cancelReset": "❌ Annuleren",
                "shareConfirmationTitle": "Deel het Spel",
                "shareConfirmationText": "Deel deze link op je favoriete platform om een bonus te verdienen!",
                "copyLink": "📋 Kopieer Link",
                "cancelShare": "❌ Annuleren",
                "tutorialTitle": "Tutorial: Hoe te Spelen",
                "tutorialContent": "Welkom bij Interstellar Trader! 🚀 Jouw doel is het bouwen van een intergalactisch handelsimperium door je schepen te laten handelen tussen planeten. Zo begin je:",
                "gameInfoTitle": "Spelinformatie",
                "gameInfoContent": "Credits: Je in-game valuta gebruikt om schepen, upgrades en andere functies te kopen.<br>Technologieniveau: Bepaalt de efficiëntie en verdiensten van je handelsactiviteiten.<br>Punten Hergeboorte (RP): Verdiend door hergeboortes, gebruikt om krachtige upgrades te kopen.",
                "gameTipsTitle": "Speltips",
                "gameTip1": "Gebruik de Kopen Aantal schakelaar om meerdere upgrades tegelijk te kopen voor snellere progressie.",
                "gameTip2": "Automatiseer handel om continu credits te verdienen, zelfs wanneer je niet actief speelt.",
                "gameTip3": "Hergeboorte strategisch om je RP te maximaliseren en groei te versnellen.",
                "gameTip4": "Upgrade je handelaren om de verdiensten per handel te verhogen.",
                "gameTip5": "Huur werknemers in om nieuwe functionaliteiten te ontgrendelen en je vloot te verbeteren.",
                "gameTip6": "Deel het spel op meerdere platforms om bonussen te verdienen en je handelsimperium te laten groeien.",
                "upgradeCostsTitle": "Upgrade Kosten",
                "upgradeCost1": "Automatisering: Kosten nemen met 1.2x toe per niveau.",
                "upgradeCost2": "Multiplicator: Kosten nemen met 1.5x toe per niveau.",
                "upgradeCost3": "Werknemers: Kosten nemen met 1.2x toe per niveau.",
                "closeHelp": "❌ Sluiten",
                "hireStorage": "📦 Huur Opslag Werknemer (In Tijd)",
                "hireEfficiency": "⚙️ Huur Efficiëntie Werknemer (Eenmalig)",
                "hireSecurity": "🛡️ Huur Beveiliging Werknemer (Eenmalig)",
                "confirmRebirthTitle": "Bevestig Hergeboorte",
                "confirmRebirthText": "Weet je zeker dat je wilt hergeboren? Dit zal al je voortgang resetten maar je krijgt <strong>{points}</strong> Punten Hergeboorte (RP).",
                "confirmResetTitle": "Bevestig Reset",
                "confirmResetText": "Weet je zeker dat je het spel wilt resetten? Deze actie kan niet ongedaan worden gemaakt.",
                "rebirthSuccess": "♻️ Je bent hergeboren! Je hebt {points} Punten Hergeboorte verdiend.",
                "rebirthCooldown": "⚠ Hergeboorte is in cooldown. Wacht {time} voordat je opnieuw hergeboort.",
                "rebirthNotEnough": "⚠ Onvoldoende credits om te hergeboren! (Vereist {cost} Credits)",
                "rebirthInfoText": "Volgende Hergeboorte over: {time}",
                "upgradeMenuTitle": "Upgrade Menu",
                "buyAutomation": "🤖 Koop Automatisering (Kosten: {cost} Credits)",
                "buyMultiplier": "✖️ Koop Multiplicator (Kosten: {cost} Credits)",
                "hireEmployee": "👨‍🚀 Huur {type} Werknemer (Kosten: {cost} Credits)",
                "upgradeTrader": "Upgrade Handelaar (Kosten: {cost} Credits)",
                "upgradeTraderMax": "Upgrade Handelaar naar Maximaal (Kosten: {cost} Credits)",
                "upgradeAllButton": "🔼 Upgrade Alles",
                "sendAllShipsButton": "⚙️ Verstuur Alle Schepen om te Handelen",
                "buyNewShipButton": "⚖️ Koop een Nieuw Ruimteschip",
                "buyUpgradeButton": "✚ Koop Upgrade",
                "rebirthButtonTitle": "♻️ Hergeboorte (Vereist 100K Credits)",
                "spendRPButtonTitle": "🔧 Gebruik RP voor Upgrades",
                "rebirthPointsDisplay": "{points} RP",
                "resetButton": "🗑️ Reset Spel",
                "resetConfirmation": "Weet je zeker dat je het spel wilt resetten? Deze actie kan niet ongedaan worden gemaakt.",
                "tradeCompleted": "✨ Het Ruimteschip {shipId} heeft een handelsmissie voltooid en verdiende {earnings} credits!",
                "buyShipCost": "⚠ Onvoldoende credits om een nieuw ruimteschip te kopen! (Kosten: {cost} Credits)",
                "buyUpgradeSuccess": "✚ Upgrade x{multiplier} gekocht! Technologieniveau verhoogd naar {techLevel}.",
                "buyUpgradeFail": "⚠ Onvoldoende credits om upgrade te kopen!",
                "hireEmployeeSuccess": "👨‍🚀 Je hebt een {type} Werknemer Niveau {level} gehuurd!",
                "hireEmployeeFail": "⚠ Onvoldoende credits om een {type} werknemer te huren! (Kosten: {cost} Credits)",
                "buyAutomationSuccess": "🤖 Automatisering gekocht voor Ruimteschip {shipId}!",
                "buyAutomationFail": "⚠ Onvoldoende credits om automatisering te kopen! (Kosten: {cost} Credits)",
                "buyMultiplierSuccess": "✖️ Multiplicator gekocht! Technologieniveau multiplicator verhoogd naar x{multiplier}.",
                "buyMultiplierFail": "⚠ Onvoldoende credits om multiplicator te kopen! (Kosten: {cost} Credits)",
                "shareSuccess": "📋 Spel link gekopieerd naar klembord! Je hebt een bonus van 500 Credits verdiend.",
                "shareFail": "⚠ Falen om de spel link te kopiëren.",
                "combineShipsRemoved": "🔗 De functie Om Schepen te Combineren is verwijderd.",
                "shipLimitUpgradeSuccess": "📈 Limeschepen verhoogd! Nieuw limiet: {newLimit} schepen.",
                "shipLimitUpgradeFail": "⚠ Onvoldoende credits om limeschepen te verhogen! (Kosten: {cost} Credits)",
                "tradeAlreadyActive": "⚙️ Ruimteschip {shipId} is al bezig met handelen.",
                "upgradeTraderSuccess": "🔼 Niveau handelaar van Ruimteschip {shipId} verhoogd met x{upgrades} naar {traderLevel}.",
                "upgradeTraderFail": "⚠ Onvoldoende credits om handelaar van Ruimteschip {shipId} te upgraden! (Kosten: {cost} Credits)",
                "randomEventAlienAttack": "💥 Een buitenaardse aanval! Je verloor 50 credits om jezelf te verdedigen.",
                "randomEventAlienAttackProtected": "🛡️ Beveiliging Werknemer beschermde je tegen een buitenaardse aanval! Geen credits verloren.",
                "randomEventMeteorShower": "☄️✨ Meteorenregen! Je schepen verdienden een bonus van 25 credits per handel.",
                "randomEventMeteorShowerBonus": "✨ Bonus: Je hebt een extra {bonus} credits verdiend door meteorenregen.",
                "randomEventGalacticFair": "🎉 Galactische beurs! Je hebt een deal gesloten en 100 bonus credits verdiend.",
                "rebirthCooldownInfo": "Volgende Hergeboorte over: {time}",
                "tradeDuration": "{duration}s",
                "tradeEarnings": "{earnings} 💸",
                "upgradeButtonTitle": "Verbeter de efficiëntie van de handelaar",
                "sendAllShipsTitle": "Verstuur alle schepen om te handelen en credits te verdienen",
                "buyNewShipTitle": "Koop een nieuw ruimteschip",
                "buyUpgradeTitle": "Koop upgrades om je technologieniveau te verhogen",
                "upgradeAllTitle": "Upgrade alle schepen op basis van de geselecteerde aankoop hoeveelheid",
                "upgradeMenuTitleModal": "Open het Upgrade Menu",
                "rebirthMenuTitleModal": "Open het Hergeboorte Menu",
                "buyAutomationTitle": "Ontgrendel automatisering om schepen automatisch te versturen",
                "buyMultiplierTitle": "Verhoog je technologiemultiplicator",
                "hireEmployeeTitle": "Huur specifieke soorten werknemers in",
                "shareGameTitle": "Deel het spel en verdien een bonus",
                "closeHelp": "❌ Sluiten",
                "openHelp": "❓ Help",
                "openSettings": "⚙️ Instellingen",
                "openRebirthMenu": "♻️ Hergeboorte Menu",
                "openUpgradeMenu": "🔧 Upgrade Menu",
                "achievementTitle": "¡Logro Desbloqueado!",
                "achievementMessage": "Has desbloqueado un nuevo logro.",
                "toggleTheme": "🌙 Cambiar Tema",
                "saveGame": "💾 Guardar Juego",
                "shareOrCopy": "O copia el enlace a continuación:",
                "closeAchievement": "❌ Cerrar"
            },
            "vi": {
                "madeBy": "Được làm bởi Static",
                "playGameHere": "Chơi Tại Đây",
                "shareGame": "🔗 Chia Sẻ Trò Chơi",
                "buyAmount": "Mua: 1x",
                "help": "❓ Trợ giúp",
                "settings": "⚙️ Cài đặt",
                "credits": "Credits",
                "spaceshipDisplay": "Tàu Vũ Trụ: 1/10 🚀",
                "techLevelDisplay": "Cấp Độ Công Nghệ: 1 ✯",
                "sendAllShips": "⚙️ Gửi Tất Cả Tàu Vũ Trụ Để Thương Mại",
                "buyNewShip": "⚖️ Mua Tàu Vũ Trụ Mới",
                "buyUpgrade": "✚ Mua Nâng Cấp",
                "upgradeAll": "🔼 Nâng Cấp Tất Cả",
                "upgradeMenu": "🔧 Menu Nâng Cấp",
                "rebirthMenu": "♻️ Menu Tái Sinh",
                "rebirthPoints": "Điểm Tái Sinh (RP):",
                "rebirthButton": "♻️ Tái Sinh (Cần 100K Credits)",
                "spendRPButton": "🔧 Sử Dụng RP Cho Nâng Cấp",
                "rebirthInfo": "",
                "confirmRebirth": "✅ Xác Nhận",
                "cancelRebirth": "❌ Hủy Bỏ",
                "resetGame": "🗑️ Đặt Lại Trò Chơi",
                "confirmReset": "✅ Xác Nhận",
                "cancelReset": "❌ Hủy Bỏ",
                "shareConfirmationTitle": "Chia Sẻ Trò Chơi",
                "shareConfirmationText": "Chia sẻ liên kết này trên nền tảng yêu thích của bạn để nhận thưởng!",
                "copyLink": "📋 Sao Chép Liên Kết",
                "cancelShare": "❌ Hủy Bỏ",
                "tutorialTitle": "Hướng Dẫn: Cách Chơi",
                "tutorialContent": "Chào mừng đến với Interstellar Trader! 🚀 Mục tiêu của bạn là xây dựng một đế chế thương mại liên hành tinh bằng cách gửi tàu vũ trụ của bạn để giao dịch hàng hóa giữa các hành tinh. Đây là cách bắt đầu:",
                "gameInfoTitle": "Thông Tin Trò Chơi",
                "gameInfoContent": "Credits: Đơn vị tiền tệ trong trò chơi của bạn được sử dụng để mua tàu, nâng cấp và các tính năng khác.<br>Cấp Độ Công Nghệ: Xác định hiệu quả và lợi nhuận của các hoạt động thương mại của bạn.<br>Điểm Tái Sinh (RP): Được kiếm thông qua việc tái sinh, được sử dụng để mua các nâng cấp mạnh mẽ.",
                "gameTipsTitle": "Mẹo Chơi",
                "gameTip1": "Sử dụng công tắc Số Lượng Mua để mua nhiều nâng cấp cùng một lúc để tiến bộ nhanh hơn.",
                "gameTip2": "Tự động hóa giao dịch để liên tục kiếm Credits ngay cả khi bạn không chơi tích cực.",
                "gameTip3": "Tái sinh một cách chiến lược để tối đa hóa RP và tăng tốc sự phát triển.",
                "gameTip4": "Nâng cấp thương nhân của bạn để tăng lợi nhuận mỗi lần giao dịch.",
                "gameTip5": "Thuê nhân viên để mở khóa các chức năng mới và nâng cao đội tàu của bạn.",
                "gameTip6": "Chia sẻ trò chơi trên nhiều nền tảng để kiếm thưởng và giúp đế chế thương mại của bạn phát triển.",
                "upgradeCostsTitle": "Chi Phí Nâng Cấp",
                "upgradeCost1": "Tự động hóa: Chi phí tăng 1.2x mỗi cấp.",
                "upgradeCost2": "Multiplicator: Chi phí tăng 1.5x mỗi cấp.",
                "upgradeCost3": "Nhân viên: Chi phí tăng 1.2x mỗi cấp.",
                "closeHelp": "❌ Đóng",
                "hireStorage": "📦 Thuê Nhân Viên Lưu Trữ (Theo Thời Gian)",
                "hireEfficiency": "⚙️ Thuê Nhân Viên Hiệu Suất (Một Lần)",
                "hireSecurity": "🛡️ Thuê Nhân Viên Bảo Mật (Một Lần)",
                "confirmRebirthTitle": "Xác Nhận Tái Sinh",
                "confirmRebirthText": "Bạn có chắc chắn muốn tái sinh không? Điều này sẽ đặt lại tất cả tiến độ của bạn nhưng sẽ cấp cho bạn <strong>{points}</strong> Điểm Tái Sinh (RP).",
                "confirmResetTitle": "Xác Nhận Đặt Lại",
                "confirmResetText": "Bạn có chắc chắn muốn đặt lại trò chơi không? Hành động này không thể hoàn tác.",
                "rebirthSuccess": "♻️ Bạn đã tái sinh! Bạn đã kiếm được {points} Điểm Tái Sinh.",
                "rebirthCooldown": "⚠ Tái sinh đang trong thời gian chờ. Vui lòng đợi {time} trước khi tái sinh lại.",
                "rebirthNotEnough": "⚠ Không đủ credits để tái sinh! (Cần {cost} Credits)",
                "rebirthInfoText": "Tái Sinh Tiếp theo sau: {time}",
                "upgradeMenuTitle": "Menu Nâng Cấp",
                "buyAutomation": "🤖 Mua Tự Động Hóa (Chi Phí: {cost} Credits)",
                "buyMultiplier": "✖️ Mua Multiplicator (Chi Phí: {cost} Credits)",
                "hireEmployee": "👨‍🚀 Mua {type} Nhân Viên (Chi Phí: {cost} Credits)",
                "upgradeTrader": "Nâng Cấp Thương Nhân (Chi Phí: {cost} Credits)",
                "upgradeTraderMax": "Nâng Cấp Thương Nhân đến Tối Đa (Chi Phí: {cost} Credits)",
                "upgradeAllButton": "🔼 Nâng Cấp Tất Cả",
                "sendAllShipsButton": "⚙️ Gửi Tất Cả Tàu Vũ Trụ Để Thương Mại",
                "buyNewShipButton": "⚖️ Mua Tàu Vũ Trụ Mới",
                "buyUpgradeButton": "✚ Mua Nâng Cấp",
                "rebirthButtonTitle": "♻️ Tái Sinh (Cần 100K Credits)",
                "spendRPButtonTitle": "🔧 Sử Dụng RP Cho Nâng Cấp",
                "rebirthPointsDisplay": "{points} RP",
                "resetButton": "🗑️ Đặt Lại Trò Chơi",
                "resetConfirmation": "Bạn có chắc chắn muốn đặt lại trò chơi không? Hành động này không thể hoàn tác.",
                "tradeCompleted": "✨ Tàu Vũ Trụ {shipId} đã hoàn thành một nhiệm vụ thương mại và kiếm được {earnings} credits!",
                "buyShipCost": "⚠ Không đủ credits để mua một tàu vũ trụ mới! (Chi Phí: {cost} Credits)",
                "buyUpgradeSuccess": "✚ Mua nâng cấp x{multiplier}! Cấp độ công nghệ tăng lên {techLevel}.",
                "buyUpgradeFail": "⚠ Không đủ credits để mua nâng cấp!",
                "hireEmployeeSuccess": "👨‍🚀 Mua {type} Nhân Viên Cấp {level}!",
                "hireEmployeeFail": "⚠ Không đủ credits để mua {type} nhân viên! (Chi Phí: {cost} Credits)",
                "buyAutomationSuccess": "🤖 Mua tự động hóa cho Tàu Vũ Trụ {shipId}!",
                "buyAutomationFail": "⚠ Không đủ credits để mua tự động hóa! (Chi Phí: {cost} Credits)",
                "buyMultiplierSuccess": "✖️ Mua Multiplicator! Multiplicator công nghệ tăng lên x{multiplier}.",
                "buyMultiplierFail": "⚠ Không đủ credits để mua multiplicator! (Chi Phí: {cost} Credits)",
                "shareSuccess": "📋 Liên kết trò chơi đã được sao chép vào bảng nhớ tạm! Bạn đã kiếm được một khoản thưởng 500 Credits.",
                "shareFail": "⚠ Không thể sao chép liên kết trò chơi.",
                "combineShipsRemoved": "🔗 Tính năng Kết Hợp Tàu Đã Bị Loại Bỏ.",
                "shipLimitUpgradeSuccess": "📈 Giới hạn tàu đã được nâng cấp! Giới hạn mới: {newLimit} tàu.",
                "shipLimitUpgradeFail": "⚠ Không đủ credits để nâng cấp giới hạn tàu! (Chi Phí: {cost} Credits)",
                "tradeAlreadyActive": "⚙️ Tàu Vũ Trụ {shipId} đang giao dịch!",
                "upgradeTraderSuccess": "🔼 Cấp độ thương nhân của Tàu Vũ Trụ {shipId} đã tăng lên x{upgrades} thành {traderLevel}.",
                "upgradeTraderFail": "⚠ Không đủ credits để nâng cấp thương nhân của Tàu Vũ Trụ {shipId}! (Chi Phí: {cost} Credits)",
                "randomEventAlienAttack": "💥 Một cuộc tấn công của người ngoài hành tinh! Bạn mất 50 credits để tự vệ.",
                "randomEventAlienAttackProtected": "🛡️ Nhân viên Bảo mật đã bảo vệ bạn khỏi cuộc tấn công của người ngoài hành tinh! Không mất credits.",
                "randomEventMeteorShower": "☄️✨ Mưa sao băng! Các tàu của bạn đã kiếm được một khoản thưởng 25 credits cho mỗi giao dịch.",
                "randomEventMeteorShowerBonus": "✨ Bonus: Bạn đã kiếm được thêm {bonus} credits từ mưa sao băng.",
                "randomEventGalacticFair": "🎉 Hội chợ thiên hà! Bạn đã thực hiện một thỏa thuận và kiếm được 100 credits thưởng.",
                "rebirthCooldownInfo": "Tái Sinh Tiếp theo sau: {time}",
                "tradeDuration": "{duration}s",
                "tradeEarnings": "{earnings} 💸",
                "upgradeButtonTitle": "Nâng cao hiệu suất thương nhân",
                "sendAllShipsTitle": "Gửi tất cả tàu để giao dịch và kiếm credits",
                "buyNewShipTitle": "Mua một tàu vũ trụ mới",
                "buyUpgradeTitle": "Mua nâng cấp để tăng cấp độ công nghệ của bạn",
                "upgradeAllTitle": "Nâng cấp tất cả tàu dựa trên số lượng mua đã chọn",
                "upgradeMenuTitleModal": "Mở Menu Nâng Cấp",
                "rebirthMenuTitleModal": "Mở Menu Tái Sinh",
                "buyAutomationTitle": "Mở khóa tự động hóa để gửi tàu tự động",
                "buyMultiplierTitle": "Tăng multiplicator cấp độ công nghệ của bạn",
                "hireEmployeeTitle": "Thuê các loại nhân viên cụ thể",
                "shareGameTitle": "Chia sẻ trò chơi và kiếm một khoản thưởng",
                "closeHelp": "❌ Đóng",
                "openHelp": "❓ Trợ giúp",
                "openSettings": "⚙️ Cài đặt",
                "openRebirthMenu": "♻️ Menu Tái Sinh",
                "openUpgradeMenu": "🔧 Menu Nâng Cấp",
                "achievementTitle": "Achievement Unlocked!",
                "achievementMessage": "You have unlocked a new achievement.",
                "toggleTheme": "🌙 Toggle Theme",
                "saveGame": "💾 Save Game",
                "shareOrCopy": "Or copy the link below:",
                "closeAchievement": "❌ Close"
            }
            // Additional languages can be added here
        };

        // ==================== GAME STATE ====================
        let gameState = {
            credits: 100,
            spaceshipCount: 1,
            techLevel: 1,
            rebirthPoints: 0,
            totalCreditsEarned: 100, // For rebirth calculation
            multiplier: 1,
            ships: [
                {
                    id: 1,
                    upgrades: 0,
                    traderLevel: 1,
                    trading: false,
                    automation: false,
                    intervalId: null // To track automation intervals
                }
            ],
            buyAmounts: ['1x', '10x', '15x', '30x', '50x', 'Max'],
            currentBuyIndex: 0, // Starts at 1x
            theme: 'dark', // or 'light', 'blue'
            shipLimit: 10, // Updated maximum ship limit
            totalTrades: 0,
            totalEarnings: 0,
            totalUpgrades: 0,
            lastSaveTime: Date.now(),
            timePlayed: 0, // In seconds
            employees: {
                storage: {
                    level: 0,
                    cost: 1000 // Initial cost for storage employee
                },
                efficiency: {
                    level: 0,
                    cost: 1500 // Initial cost for efficiency employee
                },
                security: {
                    level: 0,
                    cost: 2000 // Initial cost for security employee
                }
            },
            shareCooldown: {
                lastShareTime: 0,
                cooldownDuration: 1922 // 32 minutes and 2 seconds in seconds
            },
            rebirthCooldown: {
                lastRebirthTime: 0,
                cooldownDuration: 604800 // 7 days in seconds
            },
            securityProtection: 0, // Percentage protection against random events
            version: "v1.62.08", // Updated version
            language: "en", // Default language
            achievements: []
        };

        const VERSION = "v1.62.08"; // Updated version

        // ==================== SAVE & LOAD ====================
        function saveGame() {
            gameState.lastSaveTime = Date.now();
            try {
                const saveData = JSON.stringify(gameState);
                const encodedData = btoa(saveData); // Base64 encode
                localStorage.setItem('interstellarTraderSave', encodedData);
            } catch (e) {
                console.error("Save failed:", e);
                logEvent("⚠ Save failed due to browser restrictions.");
            }
        }

        function loadGame() {
            const savedState = localStorage.getItem('interstellarTraderSave');
            if (savedState) {
                try {
                    const decodedData = atob(savedState);
                    const parsedState = JSON.parse(decodedData);
                    // Validate and migrate if necessary
                    if (parsedState.version && parsedState.version === VERSION) {
                        gameState = parsedState;
                        migrateGameState();
                        handleOfflineProgress();
                        updateTheme();
                        updateDisplay();
                        renderShips();
                        updateLanguage();
                        updateAchievements();
                    } else {
                        logEvent("⚠ Save data version mismatch. Starting a new game.");
                        resetGameState();
                    }
                } catch (e) {
                    console.error("Load failed:", e);
                    logEvent("⚠ Load failed due to corrupted save data.");
                    // Optionally, reset game or prompt user
                }
            } else {
                addShip(1); // Initialize first ship with ID 1
                saveGame();
            }
        }

        // Auto-save every 30 seconds
        setInterval(saveGame, 30000);

        // ==================== MIGRATE GAME STATE ====================
        function migrateGameState() {
            if (!gameState.version || gameState.version !== VERSION) {
                // Handle migration if needed
                // Example: Initialize new properties for newer versions
                if (!gameState.shareCooldown) {
                    gameState.shareCooldown = {
                        lastShareTime: 0,
                        cooldownDuration: 1922 // 32 minutes and 2 seconds in seconds
                    };
                }
                if (!gameState.rebirthCooldown) {
                    gameState.rebirthCooldown = {
                        lastRebirthTime: 0,
                        cooldownDuration: 604800 // 7 days in seconds
                    };
                }
                if (!gameState.language) {
                    gameState.language = "en";
                }
                if (!gameState.achievements) {
                    gameState.achievements = [];
                }
                // Update version
                gameState.version = VERSION;
                saveGame();
            }
            // Ensure rebirthPoints and securityProtection are initialized
            if (gameState.rebirthPoints === undefined) gameState.rebirthPoints = 0;
            if (gameState.securityProtection === undefined) gameState.securityProtection = 0;
        }

        // ==================== HANDLE OFFLINE PROGRESS ====================
        function handleOfflineProgress() {
            const currentTime = Date.now();
            const offlineTime = Math.floor((currentTime - gameState.lastSaveTime) / 1000); // in seconds
            if (offlineTime > 0) {
                const effectiveTime = Math.floor(offlineTime * 0.3); // 0.3x effectiveness
                const tradeDuration = 10; // base trade duration in seconds
                let tradesPossible = 0;
                let totalProfit = 0;

                gameState.ships.forEach(ship => {
                    const efficiencyBonus = gameState.employees.efficiency.level;
                    const adjustedTradeDuration = Math.max(5, tradeDuration - efficiencyBonus);
                    tradesPossible += Math.floor(effectiveTime / adjustedTradeDuration);
                });

                tradesPossible = Math.min(tradesPossible, gameState.ships.length * 100); // Limit to prevent excessive trades

                if (tradesPossible > 0) {
                    const earningsPerTrade = Math.floor(50 * gameState.techLevel * gameState.multiplier);
                    totalProfit = earningsPerTrade * tradesPossible;
                    gameState.credits += totalProfit;
                    gameState.totalCreditsEarned += totalProfit;
                    gameState.totalEarnings += totalProfit;
                    gameState.totalTrades += tradesPossible;
                    logEvent(`⏰ You were offline for ${formatTime(offlineTime)} and earned ${formatNumberWithSuffix(totalProfit)} credits.`);
                    updateDisplay();
                    // Trigger random events if desired
                    saveGame();
                }
            }
        }

        // ==================== UPDATE DISPLAY ====================
        function updateDisplay() {
            const creditsElement = document.getElementById('credits');
            if (creditsElement) {
                creditsElement.innerText = `${formatNumberWithSuffix(gameState.credits)} 💸`;
            } else {
                console.error("Credits element not found.");
            }

            const spaceshipDisplay = document.getElementById('spaceship-display');
            if (spaceshipDisplay) {
                spaceshipDisplay.innerText = `Spaceships: ${gameState.ships.length}/${formatNumberWithSuffix(gameState.shipLimit)} 🚀`;
            } else {
                console.error("Spaceship display element not found.");
            }

            const techLevelDisplay = document.getElementById('tech-level-display');
            if (techLevelDisplay) {
                techLevelDisplay.innerHTML = `<strong>Technology Level:</strong> ${gameState.techLevel.toFixed(1)} ✯`;
            } else {
                console.error("Tech level display element not found.");
            }

            const rebirthPointsDisplay = document.getElementById('rebirth-points');
            if (rebirthPointsDisplay) {
                rebirthPointsDisplay.innerText = `${gameState.rebirthPoints} RP`;
            } else {
                console.error("Rebirth points display element not found.");
            }

            const buyAmountButton = document.querySelector('.buy-toggle button');
            if (buyAmountButton) {
                buyAmountButton.innerText = `Buy: ${gameState.buyAmounts[gameState.currentBuyIndex]}`;
            } else {
                console.error("Buy amount button not found.");
            }

            const versionNumber = document.getElementById('version-number');
            if (versionNumber) {
                versionNumber.innerText = gameState.version;
            }

            // Update upgrade buttons with dynamic costs and disable if not affordable
            const upgradeMenu = document.getElementById('upgrade-menu');
            if (upgradeMenu) {
                const automationButton = upgradeMenu.querySelector('button[onclick="buyAutomation()"]');
                const multiplierButton = upgradeMenu.querySelector('button[onclick="buyMultiplier()"]');
                const hireStorageButton = upgradeMenu.querySelector('button[onclick="hireEmployee(\'storage\')"]');
                const hireEfficiencyButton = upgradeMenu.querySelector('button[onclick="hireEmployee(\'efficiency\')"]');
                const hireSecurityButton = upgradeMenu.querySelector('button[onclick="hireEmployee(\'security\')"]');

                if (automationButton) {
                    const automationCount = gameState.ships.filter(s => s.automation).length;
                    const cost = Math.floor(500 * Math.pow(1.2, automationCount));
                    automationButton.innerText = `🤖 Buy Automation (Cost: ${formatNumberWithSuffix(cost)} Credits)`;
                    automationButton.disabled = gameState.credits < cost;
                }
                if (multiplierButton) {
                    const cost = Math.floor(10000 * Math.pow(1.5, gameState.techLevel - 1));
                    multiplierButton.innerText = `✖️ Buy Multiplier (Cost: ${formatNumberWithSuffix(cost)} Credits)`;
                    multiplierButton.disabled = gameState.credits < cost;
                }
                if (hireStorageButton) {
                    const storageCost = Math.floor(gameState.employees.storage.cost * Math.pow(1.2, gameState.employees.storage.level));
                    hireStorageButton.innerText = `📦 Hire Storage Employee (Cost: ${formatNumberWithSuffix(storageCost)} Credits)`;
                    hireStorageButton.disabled = gameState.credits < storageCost || gameState.employees.storage.level >= 10;
                }
                if (hireEfficiencyButton) {
                    const efficiencyCost = Math.floor(gameState.employees.efficiency.cost * Math.pow(1.2, gameState.employees.efficiency.level));
                    hireEfficiencyButton.innerText = `⚙️ Hire Efficiency Employee (Cost: ${formatNumberWithSuffix(efficiencyCost)} Credits)`;
                    hireEfficiencyButton.disabled = gameState.credits < efficiencyCost || gameState.employees.efficiency.level >= 10;
                }
                if (hireSecurityButton) {
                    const securityCost = Math.floor(gameState.employees.security.cost * Math.pow(1.2, gameState.employees.security.level));
                    hireSecurityButton.innerText = `🛡️ Hire Security Employee (Cost: ${formatNumberWithSuffix(securityCost)} Credits)`;
                    hireSecurityButton.disabled = gameState.credits < securityCost || gameState.employees.security.level >= 10;
                }
            }

            // Update each ship's trader upgrade button and automation indicators
            gameState.ships.forEach(ship => {
                const upgradeButton = document.querySelector(`#ship-${ship.id} .upgrade-trader-button`);
                if (upgradeButton) {
                    const cost = Math.floor(10 * Math.pow(1.5, ship.upgrades));
                    upgradeButton.innerText = `Upgrade Trader (Cost: ${formatNumberWithSuffix(cost)} Credits)`;
                    upgradeButton.disabled = gameState.credits < cost;
                } else {
                    logEvent(`⚠ Upgrade button for Ship ${ship.id} not found.`);
                }
            });

            // Update automation indicators
            gameState.ships.forEach(ship => {
                const shipDiv = document.getElementById(`ship-${ship.id}`);
                if (shipDiv) {
                    if (ship.automation) {
                        shipDiv.classList.add('automation');
                    } else {
                        shipDiv.classList.remove('automation');
                    }
                } else {
                    logEvent(`⚠ Ship div for Ship ${ship.id} not found.`);
                }
            });

            // Update achievements
            updateAchievements();

            // Update high score if applicable
            updateHighScore();
        }

        function formatNumber(num) {
            return Math.round(num).toString();
        }

        function formatNumberWithSuffix(num) {
            if (num >= 1e12) {
                return (num / 1e12).toFixed(2).replace(/\.00$/, '') + 'T';
            }
            if (num >= 1e9) {
                return (num / 1e9).toFixed(2).replace(/\.00$/, '') + 'B';
            }
            if (num >= 1e6) {
                return (num / 1e6).toFixed(2).replace(/\.00$/, '') + 'M';
            }
            if (num >= 1e3) {
                return (num / 1e3).toFixed(2).replace(/\.00$/, '') + 'K';
            }
            return num.toString();
        }

        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            return `${hrs}h ${mins}m ${secs}s`;
        }

        // ==================== LOG EVENTS ====================
        const eventLog = document.getElementById('event-log');

        function logEvent(message) {
            const p = document.createElement('p');
            const timestamp = new Date().toLocaleTimeString();
            if (message.includes("{") && message.includes("}")) {
                // Replace placeholders with actual values if any
                // Example: {shipId}, {earnings}, etc.
                p.innerHTML = `[${timestamp}] ${replacePlaceholders(message)}`;
            } else {
                p.innerText = `[${timestamp}] ${message}`;
            }
            eventLog.appendChild(p);
            
            // Limit to last 100 entries
            if (eventLog.children.length > 100) {
                eventLog.removeChild(eventLog.firstChild);
            }
            
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        function replacePlaceholders(text) {
            return text.replace(/{(\w+)}/g, (match, key) => {
                return gameState[key] !== undefined ? gameState[key] : match;
            });
        }

        // ==================== SHIP MANAGEMENT ====================
        function addShip(shipId, traderLevel = 1, upgrades = 0, automation = false) {
            const shipDiv = document.createElement('div');
            shipDiv.classList.add('ship');
            shipDiv.id = `ship-${shipId}`;
            if (automation) {
                shipDiv.classList.add('automation');
            }
            shipDiv.innerHTML = `
                <div class="upgrade-count">🔼 ${upgrades}</div>
                <span>🚀 Ship ${shipId}</span>
                <p>Trader Level: <span id="trader-level-${shipId}">${traderLevel}</span></p>
                <div class="progress-bar" title="Click anywhere on the ship to start trade">
                    <div class="progress" id="progress-${shipId}"></div>
                    <span class="progress-time" id="progress-time-${shipId}">10s</span>
                    <span class="progress-earnings" id="progress-earnings-${shipId}">0 💸</span>
                </div>
                <button class="button upgrade-trader-button" onclick="buyBetterTrader(${shipId})" title="Enhance trader efficiency" data-localize="upgradeTrader">Upgrade Trader</button>
                <div class="automation-indicator" title="Automated Trading">🤖</div>
            `;
            // Event Listener for clicking the ship area to start trade
            const shipClickableArea = shipDiv;
            shipClickableArea.addEventListener('click', function(event) {
                // Prevent triggering when clicking on the upgrade button
                if (event.target.tagName.toLowerCase() !== 'button' && !event.target.classList.contains('upgrade-trader-button')) {
                    startTrade(shipId);
                }
            });
            // Append to Ship Container
            const shipContainer = document.getElementById('ship-container');
            if (shipContainer) {
                shipContainer.appendChild(shipDiv);
            } else {
                console.error("Ship container not found.");
            }
        }

        function renderShips() {
            const shipContainer = document.getElementById('ship-container');
            if (!shipContainer) {
                logEvent(`⚠ Ship container not found.`);
                return;
            }
            shipContainer.innerHTML = '';
            // Render all ships
            gameState.ships.sort((a, b) => a.id - b.id).forEach(ship => {
                addShip(ship.id, ship.traderLevel, ship.upgrades, ship.automation);
            });
        }

        function sendShip(shipId) {
            const ship = gameState.ships.find(s => s.id === shipId);
            if (!ship || ship.trading) return;

            const progressBar = document.getElementById(`progress-${ship.id}`);
            const progressTime = document.getElementById(`progress-time-${ship.id}`);
            const progressEarnings = document.getElementById(`progress-earnings-${ship.id}`);
            if (!progressBar || !progressTime || !progressEarnings) {
                logEvent(`⚠ Unable to start trade for Ship ${ship.id}.`);
                return;
            }

            progressBar.style.width = '0%';
            progressTime.innerText = '10s';
            progressEarnings.innerText = `0 💸`;
            ship.trading = true;

            let progress = 0;
            let tradeDuration = 10; // base trade duration in seconds

            // Apply Efficiency Employee bonus: each level reduces duration by 1 second
            const efficiencyBonus = gameState.employees.efficiency.level;
            tradeDuration = Math.max(5, tradeDuration - efficiencyBonus);

            // Apply Upgrades: every 5 upgrades reduce duration by 1 second
            const upgradeBonus = Math.floor(ship.upgrades / 5);
            tradeDuration = Math.max(5, tradeDuration - upgradeBonus);

            const intervalTime = 1000; // 1 second intervals

            const progressInterval = setInterval(() => {
                progress++;
                const percentage = (progress / tradeDuration) * 100;
                progressBar.style.width = percentage + '%';
                progressTime.innerText = `${tradeDuration - progress}s`;
                const earnings = Math.floor(50 * gameState.techLevel * ship.traderLevel * gameState.multiplier);
                progressEarnings.innerText = `${formatNumberWithSuffix(earnings)} 💸`;

                if (progress >= tradeDuration) {
                    clearInterval(progressInterval);
                    ship.trading = false;
                    gameState.credits += earnings;
                    gameState.totalCreditsEarned += earnings;
                    gameState.totalEarnings += earnings;
                    gameState.totalTrades += 1;
                    logEvent(`✨ Ship ${ship.id} completed a trade mission and earned ${formatNumberWithSuffix(earnings)} credits!`);
                    progressBar.style.width = '0%'; // Reset progress bar
                    updateDisplay();
                    triggerRandomEvent();
                    saveGame();
                    // If automation is enabled, start the next trade automatically
                    if (ship.automation) {
                        setTimeout(() => {
                            sendShip(ship.id);
                        }, 1000); // slight delay before starting next trade
                    }
                }
            }, intervalTime);
        }

        function sendAllShips() {
            gameState.ships.forEach(ship => {
                if (!ship.trading) {
                    sendShip(ship.id);
                }
            });
            logEvent(`⚙️ All ships have been sent to trade missions.`);
            updateDisplay();
            saveGame();
        }

        function startTrade(shipId) {
            const ship = gameState.ships.find(s => s.id === shipId);
            if (ship && !ship.trading) {
                sendShip(shipId);
            }
        }

        function buyShip() {
            if (gameState.ships.length >= gameState.shipLimit) {
                logEvent(`⚠ You've reached the maximum number of ships (${formatNumberWithSuffix(gameState.shipLimit)}). Upgrade to add more.`);
                return;
            }
            const cost = Math.floor(80 * Math.pow(1.15, gameState.ships.length));
            if (gameState.credits >= cost) {
                gameState.credits -= cost;
                const newShipId = gameState.ships.length > 0 ? Math.max(...gameState.ships.map(s => s.id)) + 1 : 1;
                gameState.ships.push({
                    id: newShipId,
                    upgrades: 0,
                    traderLevel: 1,
                    trading: false,
                    automation: false,
                    intervalId: null
                });
                addShip(newShipId);
                logEvent(`🚀 You bought a new spaceship! Total spaceships: ${gameState.ships.length}`);
                updateDisplay();
                saveGame();
            } else {
                logEvent(`⚠ Not enough credits to buy a new ship! (Cost: ${formatNumberWithSuffix(cost)} Credits)`);
            }
        }

        // ==================== UPGRADE MANAGEMENT ====================
        function buyUpgrade() {
            let multiplier = gameState.buyAmounts[gameState.currentBuyIndex];
            multiplier = multiplier === 'Max' ? 'max' : parseInt(multiplier.replace('x', ''));

            let totalCost = 0;
            let achievableMultiplier = multiplier;

            const costPerUpgrade = Math.floor(10 * Math.pow(1.5, gameState.techLevel - 1));
            if (multiplier === 'Max') {
                achievableMultiplier = Math.floor(gameState.credits / (costPerUpgrade * gameState.ships.length));
                totalCost = costPerUpgrade * achievableMultiplier * gameState.ships.length;
            } else {
                totalCost = costPerUpgrade * multiplier * gameState.ships.length;
            }

            if (gameState.credits >= totalCost && achievableMultiplier > 0) {
                gameState.credits -= totalCost;
                gameState.techLevel += achievableMultiplier;
                gameState.totalUpgrades += achievableMultiplier;
                logEvent(`✚ Bought upgrade x${achievableMultiplier}! Tech level increased to ${gameState.techLevel}.`);
                updateDisplay();
                saveGame();
            } else {
                logEvent(`⚠ Not enough credits to buy upgrade!`);
            }
        }

        function toggleUpgradeMenu() {
            const upgradeMenu = document.getElementById('upgrade-menu');
            if (upgradeMenu) {
                upgradeMenu.style.display = upgradeMenu.style.display === 'block' ? 'none' : 'block';
            } else {
                logEvent(`⚠ Upgrade Menu not found.`);
            }
        }

        function buyAutomation() {
            // Buy automation for the first ship without automation
            const nextShip = gameState.ships.find(ship => !ship.automation);
            if (!nextShip) {
                logEvent(`⚠ All ships already have automation.`);
                return;
            }
            const automationCount = gameState.ships.filter(s => s.automation).length;
            const cost = Math.floor(500 * Math.pow(1.2, automationCount));
            if (gameState.credits >= cost) {
                gameState.credits -= cost;
                nextShip.automation = true;
                logEvent(`🤖 Automation purchased for Ship ${nextShip.id}!`);
                updateDisplay();
                saveGame();
                // Start automation if ship is not trading
                if (!nextShip.trading) {
                    sendShip(nextShip.id);
                }
            } else {
                logEvent(`⚠ Not enough credits to buy automation! (Cost: ${formatNumberWithSuffix(cost)} Credits)`);
            }
        }

        function buyMultiplier() {
            const cost = Math.floor(10000 * Math.pow(1.5, gameState.techLevel - 1));
            if (gameState.credits >= cost) {
                gameState.credits -= cost;
                gameState.multiplier += 1;
                gameState.totalUpgrades += 1;
                logEvent(`✖️ Multiplier purchased! Technology multiplier increased to x${gameState.multiplier}.`);
                updateDisplay();
                saveGame();
            } else {
                logEvent(`⚠ Not enough credits to buy multiplier! (Cost: ${formatNumberWithSuffix(cost)} Credits)`);
            }
        }

        // ==================== EMPLOYEE MANAGEMENT ====================
        function hireEmployee(type) {
            const employee = gameState.employees[type];
            if (!employee) {
                logEvent(`⚠ Invalid employee type: ${type}.`);
                return;
            }
            const cost = Math.floor(employee.cost * Math.pow(1.2, employee.level));
            const maxLevel = 10; // Example maximum level
            if (employee.level >= maxLevel) {
                logEvent(`⚠ You have reached the maximum level for ${capitalize(type)} Employees.`);
                return;
            }
            if (gameState.credits >= cost) {
                gameState.credits -= cost;
                gameState.employees[type].level += 1;
                logEvent(`👨‍🚀 Hired a Level ${gameState.employees[type].level} ${capitalize(type)} Employee!`);
                // Apply employee-specific benefits
                switch(type) {
                    case 'storage':
                        const shipsToAdd = 2; // Each level adds 2 ships
                        gameState.shipLimit += shipsToAdd;
                        logEvent(`📦 Storage Employee increased ship limit by ${formatNumberWithSuffix(shipsToAdd)} ships to ${formatNumberWithSuffix(gameState.shipLimit)}.`);
                        break;
                    case 'efficiency':
                        // One-time increase in tech level multiplier
                        gameState.multiplier += 0.5; // Example: each Efficiency Employee increases multiplier by 0.5
                        logEvent(`⚙️ Efficiency Employee improved trade efficiency. Tech multiplier increased to x${gameState.multiplier}.`);
                        break;
                    case 'security':
                        // One-time increase in protection against random events
                        gameState.securityProtection += 10; // Each Security Employee increases protection by 10%
                        logEvent(`🛡️ Security Employee increased protection against random events by 10%. Current Protection: ${gameState.securityProtection}%`);
                        break;
                    default:
                        break;
                }
                updateDisplay();
                saveGame();
            } else {
                logEvent(`⚠ Not enough credits to hire ${capitalize(type)} employee! (Cost: ${formatNumberWithSuffix(cost)} Credits)`);
            }
        }

        // ==================== UPGRADE ALL ====================
        function upgradeAll() {
            let multiplier = gameState.buyAmounts[gameState.currentBuyIndex];
            multiplier = multiplier === 'Max' ? 'max' : parseInt(multiplier.replace('x', ''));

            if (multiplier === 'Max') {
                // Upgrade all ships as much as possible, prioritizing cheaper upgrades
                gameState.ships.sort((a, b) => Math.floor(10 * Math.pow(1.5, a.upgrades)) - Math.floor(10 * Math.pow(1.5, b.upgrades))).forEach(ship => {
                    while (true) {
                        const cost = Math.floor(10 * Math.pow(1.5, ship.upgrades));
                        if (gameState.credits >= cost) {
                            gameState.credits -= cost;
                            ship.traderLevel += 1;
                            ship.upgrades += 1;
                            gameState.techLevel += 0.1; // Increment tech level slightly for each upgrade
                            gameState.totalUpgrades += 1;
                            logEvent(`🔼 Ship ${ship.id} trader level increased to ${ship.traderLevel}.`);
                        } else {
                            break;
                        }
                    }
                });
            } else {
                // Upgrade all ships based on multiplier
                for (let i = 0; i < multiplier; i++) {
                    gameState.ships.sort((a, b) => Math.floor(10 * Math.pow(1.5, a.upgrades)) - Math.floor(10 * Math.pow(1.5, b.upgrades))).forEach(ship => {
                        const cost = Math.floor(10 * Math.pow(1.5, ship.upgrades));
                        if (gameState.credits >= cost) {
                            gameState.credits -= cost;
                            ship.traderLevel += 1;
                            ship.upgrades += 1;
                            gameState.techLevel += 0.1; // Increment tech level slightly for each upgrade
                            gameState.totalUpgrades += 1;
                            logEvent(`🔼 Ship ${ship.id} trader level increased to ${ship.traderLevel}.`);
                        }
                    });
                }
            }

            updateDisplay();
            saveGame();
        }

        // ==================== REBIRTH SYSTEM ====================
        function toggleRebirthMenu() {
            const rebirthMenu = document.getElementById('rebirth-menu');
            if (rebirthMenu) {
                rebirthMenu.style.display = rebirthMenu.style.display === 'block' ? 'none' : 'block';
                updateRebirthInfo();
            } else {
                logEvent(`⚠ Rebirth Menu not found.`);
            }
        }

        function confirmRebirth() {
            if (gameState.credits >= 100000) {
                openRebirthModalConfirm();
            } else {
                logEvent(`⚠ Not enough credits to rebirth! (Requires 100K Credits)`);
            }
        }

        function rebirth() {
            const requiredCredits = 100000;
            if (gameState.credits >= requiredCredits) {
                // Check rebirth cooldown
                const currentTime = Math.floor(Date.now() / 1000); // Current time in seconds
                if (currentTime - gameState.rebirthCooldown.lastRebirthTime < gameState.rebirthCooldown.cooldownDuration) {
                    const remaining = gameState.rebirthCooldown.cooldownDuration - (currentTime - gameState.rebirthCooldown.lastRebirthTime);
                    logEvent(`⚠ Rebirth is on cooldown. Please wait ${formatTime(remaining)} before rebirthing again.`);
                    return;
                }

                // Calculate Rebirth Points based on totalCreditsEarned
                const pointsEarned = Math.floor(gameState.totalCreditsEarned / 100000); // 100K credits = 1 RP
                if (pointsEarned < 1) {
                    logEvent(`⚠ Not enough total credits to rebirth!`);
                    return;
                }

                gameState.rebirthPoints += pointsEarned;
                // Reset game state but keep rebirth points and certain upgrades
                gameState.credits = 100;
                gameState.techLevel = 1;
                gameState.totalCreditsEarned = 100;
                gameState.multiplier = 1;
                gameState.shipLimit = 10;
                gameState.totalTrades = 0;
                gameState.totalEarnings = 0;
                gameState.totalUpgrades = 0;
                gameState.currentBuyIndex = 0; // Reset buy amount to 1x
                gameState.employees = {
                    storage: { level: 0, cost: 1000 },
                    efficiency: { level: 0, cost: 1500 },
                    security: { level: 0, cost: 2000 }
                };
                gameState.securityProtection = 0;

                // Reset ships to only ship 1
                gameState.ships = [{
                    id: 1,
                    upgrades: 0,
                    traderLevel: 1,
                    trading: false,
                    automation: false,
                    intervalId: null
                }];
                renderShips();

                // Clear all intervals before resetting ships
                clearAllIntervals();

                // Set rebirth cooldown
                gameState.rebirthCooldown.lastRebirthTime = currentTime;

                logEvent(`♻️ You have rebirthed! Earned ${pointsEarned} Rebirth Points.`);
                triggerAchievement('First Rebirth');
                updateDisplay();
                closeRebirthModalConfirm();
                saveGame();
            } else {
                logEvent(`⚠ Not enough credits to rebirth! (Requires ${formatNumberWithSuffix(requiredCredits)} Credits)`);
            }
        }

        function spendRebirthPoints() {
            if (gameState.rebirthPoints > 0) {
                // Example: Each RP increases tech level by 1
                gameState.techLevel += gameState.rebirthPoints;
                gameState.totalUpgrades += gameState.rebirthPoints;
                logEvent(`🔧 You spent ${gameState.rebirthPoints} Rebirth Points to increase tech level by ${gameState.rebirthPoints}.`);
                triggerAchievement('Spent Rebirth Points');
                gameState.rebirthPoints = 0;
                updateDisplay();
                saveGame();
            } else {
                logEvent(`⚠ No Rebirth Points to spend!`);
            }
        }

        // ==================== RANDOM EVENTS ====================
        function triggerRandomEvent() {
            // Random events have been removed as per user instructions
            // If you wish to add alternative events, implement them here
        }

        // ==================== ACHIEVEMENTS ====================
        function triggerAchievement(name) {
            if (!gameState.achievements.includes(name)) {
                gameState.achievements.push(name);
                logEvent(`🏆 Achievement Unlocked: ${name}`);
                showAchievementModal(name);
                saveGame();
            }
        }

        function showAchievementModal(name) {
            const achievementModal = document.getElementById('achievement-modal');
            const achievementMessage = document.getElementById('achievement-message');
            if (achievementModal && achievementMessage) {
                achievementMessage.innerText = `You have unlocked the achievement: ${name}`;
                achievementModal.style.display = 'block';
            }
        }

        function closeAchievementModal() {
            const achievementModal = document.getElementById('achievement-modal');
            if (achievementModal) {
                achievementModal.style.display = 'none';
            }
        }

        function updateAchievements() {
            // This function can be expanded to display achievements in the UI
            // For now, it ensures achievements are saved and triggered properly
        }

        // ==================== SHARE FEATURE ====================
        function shareGame() {
            const currentTime = Math.floor(Date.now() / 1000); // Current time in seconds
            if (currentTime - gameState.shareCooldown.lastShareTime < gameState.shareCooldown.cooldownDuration) {
                const remaining = gameState.shareCooldown.cooldownDuration - (currentTime - gameState.shareCooldown.lastShareTime);
                logEvent(`⚠ Share bonus is on cooldown. Please wait ${formatTime(remaining)} before sharing again.`);
                return;
            }
            const shareModal = document.getElementById('share-confirm-modal');
            if (shareModal) {
                shareModal.style.display = 'block';
            } else {
                logEvent(`⚠ Share Confirmation Modal not found.`);
            }
        }

        function closeShareConfirmModal() {
            const shareModal = document.getElementById('share-confirm-modal');
            if (shareModal) {
                shareModal.style.display = 'none';
            }
        }

        function copyShareLink() {
            const shareLink = document.getElementById('share-link');
            if (!shareLink) {
                logEvent(`⚠ Share Link element not found.`);
                return;
            }
            shareLink.select();
            shareLink.setSelectionRange(0, 99999); // For mobile devices

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    logEvent(`📋 Game link copied to clipboard! You earned a 500 Credits bonus.`);
                    gameState.credits += 500;
                    gameState.totalCreditsEarned += 500;
                    gameState.totalEarnings += 500;
                    // Update share cooldown
                    gameState.shareCooldown.lastShareTime = Math.floor(Date.now() / 1000);
                    triggerAchievement('First Share');
                    updateDisplay();
                    saveGame();
                } else {
                    logEvent(`⚠ Failed to copy the game link.`);
                }
            } catch (err) {
                console.error('Failed to copy:', err);
                logEvent(`⚠ Failed to copy the game link.`);
            }

            closeShareConfirmModal();
        }

        // ==================== UPGRADE COUNT ====================
        // Already handled within ship modules

        // ==================== KEY BINDINGS ====================
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAllModals();
            }
            if (e.key === 'Control') {
                setBuyMode(4); // 50x
            }
            if (e.key === 'Shift') {
                setBuyMode(1); // 10x
            }
        });

        document.addEventListener('keyup', function(e) {
            if (e.key === 'Control' || e.key === 'Shift') {
                setBuyMode(0); // Reset to 1x
            }
        });

        function toggleBuyAmount() {
            gameState.currentBuyIndex = (gameState.currentBuyIndex + 1) % gameState.buyAmounts.length;
            const buyAmountButton = document.querySelector('.buy-toggle button');
            if (buyAmountButton) {
                buyAmountButton.innerText = `Buy: ${gameState.buyAmounts[gameState.currentBuyIndex]}`;
            }
            saveGame();
        }

        function setBuyMode(modeIndex) {
            if (modeIndex >=0 && modeIndex < gameState.buyAmounts.length) {
                gameState.currentBuyIndex = modeIndex;
                const buyAmountButton = document.querySelector('.buy-toggle button');
                if (buyAmountButton) {
                    buyAmountButton.innerText = `Buy: ${gameState.buyAmounts[gameState.currentBuyIndex]}`;
                } else {
                    console.error("Buy amount button not found.");
                }
                saveGame();
            }
        }

        // ==================== THEME TOGGLE ====================
        function toggleTheme() {
            if (gameState.theme === 'dark') {
                gameState.theme = 'light';
            } else if (gameState.theme === 'light') {
                gameState.theme = 'blue';
            } else {
                gameState.theme = 'dark';
            }
            updateTheme();
            saveGame();
        }

        function updateTheme() {
            document.body.classList.remove('light-theme', 'blue-theme');
            if (gameState.theme === 'light') {
                document.body.classList.add('light-theme');
            } else if (gameState.theme === 'blue') {
                document.body.classList.add('blue-theme');
            }
            // Update modal themes
            document.querySelectorAll('.modal-content').forEach(modal => {
                modal.classList.remove('light-theme', 'blue-theme');
                if (gameState.theme === 'light') {
                    modal.classList.add('light-theme');
                } else if (gameState.theme === 'blue') {
                    modal.classList.add('blue-theme');
                }
            });
        }

        // ==================== SETTINGS MENU ====================
        function toggleSettings() {
            const settingsMenu = document.getElementById('settings-menu');
            if (settingsMenu) {
                settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
            } else {
                logEvent(`⚠ Settings Menu not found.`);
            }
        }

        function resetGame() {
            openResetModal();
        }

        function performReset() {
            localStorage.removeItem('interstellarTraderSave');
            location.reload();
        }

        function saveGameManually() {
            saveGame();
            showManualSaveFeedback();
        }

        function showManualSaveFeedback() {
            const rebirthInfo = document.getElementById('rebirth-info');
            if (rebirthInfo) {
                rebirthInfo.innerHTML = `<span style="color: green;">✅ Game has been saved!</span>`;
                setTimeout(() => {
                    rebirthInfo.innerHTML = "";
                }, 2000);
            }
            logEvent(`💾 Game has been saved!`);
        }

        // ==================== HELP MENU ====================
        function toggleHelp() {
            const helpMenu = document.getElementById('help-menu');
            if (helpMenu) {
                helpMenu.style.display = helpMenu.style.display === 'block' ? 'none' : 'block';
            } else {
                logEvent(`⚠ Help Menu not found.`);
            }
        }

        // ==================== MODALS ====================
        function openRebirthModalConfirm() {
            const rebirthConfirmModal = document.getElementById('rebirth-modal-confirm');
            if (rebirthConfirmModal) {
                const pointsEarned = Math.floor(gameState.totalCreditsEarned / 100000);
                const rebirthText = gameState.language === 'en' ? `Are you sure you want to rebirth? This will reset all your progress but grant you <strong>${pointsEarned}</strong> Rebirth Points (RP).` : localization[gameState.language].confirmRebirthText.replace("{points}", pointsEarned);
                rebirthConfirmModal.querySelector('p').innerHTML = rebirthText;
                rebirthConfirmModal.style.display = 'block';
            } else {
                logEvent(`⚠ Rebirth Confirmation Modal not found.`);
            }
        }

        function closeRebirthModal() {
            const rebirthConfirmModal = document.getElementById('rebirth-modal-confirm');
            if (rebirthConfirmModal) {
                rebirthConfirmModal.style.display = 'none';
            }
        }

        function openResetModal() {
            const resetModal = document.getElementById('reset-modal');
            if (resetModal) {
                resetModal.style.display = 'block';
            } else {
                logEvent(`⚠ Reset Modal not found.`);
            }
        }

        function closeResetModal() {
            const resetModal = document.getElementById('reset-modal');
            if (resetModal) {
                resetModal.style.display = 'none';
            }
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal-menu');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // Close modals when clicking outside of them
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal-menu');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // ==================== INITIALIZE GAME ====================
        function initialize() {
            loadGame();
            updateDisplay();
            // Start time played counter only when tab is active
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    startTimeCounter();
                    resumeMusic();
                } else {
                    stopTimeCounter();
                    pauseMusic();
                }
            });
            startTimeCounter();
            updateRebirthMenu();
            setInterval(updateRebirthMenu, 1000); // Update every second
            addAchievementListeners();
            playBackgroundMusic();
        }

        let timeCounterInterval = null;

        function startTimeCounter() {
            if (!timeCounterInterval) {
                timeCounterInterval = setInterval(() => {
                    gameState.timePlayed += 1;
                }, 1000);
            }
        }

        function stopTimeCounter() {
            if (timeCounterInterval) {
                clearInterval(timeCounterInterval);
                timeCounterInterval = null;
            }
        }

        window.onload = initialize;

        // ==================== CLEAR ALL INTERVALS ====================
        function clearAllIntervals() {
            gameState.ships.forEach(ship => {
                if (ship.intervalId) {
                    clearInterval(ship.intervalId);
                    ship.intervalId = null;
                }
            });
            // No employee intervals implemented, but placeholder if added in future
        }

        // ==================== HELP FEATURE ====================
        // Already implemented with toggleHelp()

        // ==================== HIGHLIGHT CREDITS ====================
        // Already handled in updateDisplay()

        // ==================== REBIRTH MENU UPDATE ====================
        function updateRebirthInfo() {
            const rebirthInfo = document.getElementById('rebirth-info');
            if (rebirthInfo) {
                const currentTime = Math.floor(Date.now() / 1000);
                const elapsed = currentTime - gameState.rebirthCooldown.lastRebirthTime;
                if (elapsed < gameState.rebirthCooldown.cooldownDuration) {
                    const remaining = gameState.rebirthCooldown.cooldownDuration - elapsed;
                    rebirthInfo.innerHTML = `Next Rebirth in: <span style="color: red;">${formatTime(remaining)}</span>`;
                } else {
                    rebirthInfo.innerHTML = `You can rebirth now!`;
                }
            }
        }

        function updateRebirthMenu() {
            const rebirthMenu = document.getElementById('rebirth-menu');
            if (rebirthMenu && rebirthMenu.style.display === 'block') {
                updateRebirthInfo();
            }
        }

        // ==================== LANGUAGE LOCALIZATION ====================
        function updateLanguage() {
            const lang = gameState.language;
            const texts = localization[lang] || localization['en'];
            document.querySelectorAll('[data-localize]').forEach(element => {
                const key = element.getAttribute('data-localize');
                if (texts[key]) {
                    if (element.tagName.toLowerCase() === 'input') {
                        element.placeholder = texts[key];
                    } else {
                        element.innerHTML = texts[key];
                    }
                }
            });

            // Update dynamic texts in event log or other places if necessary
            updateDisplay();
        }

        function changeLanguage(lang) {
            if (localization[lang]) {
                gameState.language = lang;
                updateLanguage();
                saveGame();
            }
        }

        // ==================== MANUAL SAVE & LOAD ====================
        // Implement Export and Import Save Code functionality
        function exportSaveCode() {
            try {
                const saveData = JSON.stringify(gameState);
                const encodedData = btoa(saveData); // Base64 encode
                prompt("Copy your save code below:", encodedData);
                logEvent(`💾 Save code exported successfully.`);
            } catch (e) {
                console.error("Export failed:", e);
                logEvent("⚠ Failed to export save code.");
            }
        }

        function importSaveCode() {
            const saveCode = prompt("Paste your save code below:");
            if (saveCode) {
                try {
                    const decodedData = atob(saveCode);
                    const parsedState = JSON.parse(decodedData);
                    // Validate and migrate if necessary
                    if (parsedState.version && parsedState.version === VERSION) {
                        gameState = parsedState;
                        migrateGameState();
                        handleOfflineProgress();
                        updateTheme();
                        updateDisplay();
                        renderShips();
                        updateLanguage();
                        updateAchievements();
                        logEvent(`💾 Save code imported successfully.`);
                    } else {
                        logEvent(`⚠ Invalid save code version.`);
                    }
                } catch (e) {
                    console.error("Import failed:", e);
                    logEvent(`⚠ Failed to import save code. Please ensure it's correct.`);
                }
            }
        }

        // ==================== HIGH SCORE ====================
        function updateHighScore() {
            // Placeholder for high score logic
            // Implement if applicable
        }

        // ==================== POP-UP NOTIFICATIONS ====================
        // Implement a simple notification system to queue messages
        let notificationQueue = [];
        let notificationActive = false;

        function showNotification(message, type = 'info') {
            notificationQueue.push({message, type});
            processNotifications();
        }

        function processNotifications() {
            if (notificationActive || notificationQueue.length === 0) return;
            notificationActive = true;
            const {message, type} = notificationQueue.shift();
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = type === 'success' ? '#4caf50' :
                                               type === 'error' ? '#f44336' :
                                               '#333';
            notification.style.color = '#fff';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '5px';
            notification.style.boxShadow = '0 0 10px rgba(0,0,0,0.5)';
            notification.style.zIndex = '1003';
            notification.innerText = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
                notificationActive = false;
                processNotifications();
            }, 3000);
        }

        // ==================== BACKGROUND MUSIC ====================
        let backgroundMusic = new Audio('https://www.bensound.com/bensound-music/bensound-slowmotion.mp3');
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.5;

        function playBackgroundMusic() {
            backgroundMusic.play().catch(error => {
                console.error("Background music play failed:", error);
            });
        }

        function pauseMusic() {
            backgroundMusic.pause();
        }

        function resumeMusic() {
            backgroundMusic.play().catch(error => {
                console.error("Background music resume failed:", error);
            });
        }

        // ==================== ACHIEVEMENT LISTENERS ====================
        function addAchievementListeners() {
            // Example achievements
            // These should be expanded based on game design
            const achievements = {
                'First Trade': {
                    condition: () => gameState.totalTrades >= 1,
                    message: 'Completed your first trade mission!'
                },
                'Collector': {
                    condition: () => gameState.ships.length >= 5,
                    message: 'Collected 5 spaceships!'
                },
                'Technologist': {
                    condition: () => gameState.techLevel >= 10,
                    message: 'Reached Technology Level 10!'
                },
                'First Rebirth': {
                    condition: () => gameState.rebirthPoints >= 1,
                    message: 'Performed your first rebirth!'
                },
                'First Share': {
                    condition: () => gameState.credits >= 500, // Assuming 500 credits from share
                    message: 'Shared the game for the first time!'
                },
                'Spent Rebirth Points': {
                    condition: () => gameState.rebirthPoints === 0 && gameState.techLevel > 1,
                    message: 'Spent your Rebirth Points!'
                }
                // Add more achievements as needed
            };

            for (let name in achievements) {
                if (achievements[name].condition() && !gameState.achievements.includes(name)) {
                    triggerAchievement(name);
                }
            }
        }

        // ==================== BACKUP LOCALSTORAGE ====================
        function backupLocalStorage() {
            try {
                const backupData = JSON.stringify(gameState);
                const encodedBackup = btoa(backupData);
                localStorage.setItem('interstellarTraderBackup', encodedBackup);
            } catch (e) {
                console.error("Backup failed:", e);
                logEvent("⚠ Backup failed.");
            }
        }

        function restoreFromBackup() {
            const backupState = localStorage.getItem('interstellarTraderBackup');
            if (backupState) {
                try {
                    const decodedBackup = atob(backupState);
                    const parsedBackup = JSON.parse(decodedBackup);
                    gameState = parsedBackup;
                    migrateGameState();
                    handleOfflineProgress();
                    updateTheme();
                    updateDisplay();
                    renderShips();
                    updateLanguage();
                    updateAchievements();
                    logEvent(`💾 Restored from backup successfully.`);
                } catch (e) {
                    console.error("Restore backup failed:", e);
                    logEvent(`⚠ Failed to restore from backup.`);
                }
            }
        }

        // ==================== GAME OVER DETECTION ====================
        function checkGameOver() {
            // Placeholder logic for game-over detection
            // Implement actual game-over conditions based on game mechanics
            // Example: No ships left or no possible upgrades
            if (gameState.ships.length === 0) {
                logEvent(`🎮 Game Over: You have no ships left.`);
                showGameOver();
            }
        }

        function showGameOver() {
            // Implement game over modal or actions
            alert("Game Over! You have no ships left.");
        }

        // ==================== UNDO FEATURE ====================
        let undoStack = [];

        function pushUndoState() {
            const stateCopy = JSON.parse(JSON.stringify(gameState));
            undoStack.push(stateCopy);
            // Limit undo stack size
            if (undoStack.length > 20) {
                undoStack.shift();
            }
        }

        function undo() {
            if (undoStack.length > 0) {
                gameState = undoStack.pop();
                updateTheme();
                updateDisplay();
                renderShips();
                updateLanguage();
                updateAchievements();
                logEvent(`🔄 Undid the last action.`);
                saveGame();
            } else {
                logEvent(`⚠ No actions to undo.`);
            }
        }

        // ==================== SHARE BUTTON COOLDOWN ====================
        // Already handled with shareCooldown in shareGame()

        // ==================== GAME OVER DETECTION ====================
        // Integrated with checkGameOver() and showGameOver()

        // ==================== ASSISTANT FUNCTIONS ====================
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // ==================== GAME OVER CHECKER ====================
        // Example trigger after each trade
        function triggerGameOverCheck() {
            checkGameOver();
        }

        // ==================== PAUSE/RESUME ====================
        // Implemented with visibilitychange event and background music pause/resume

        // ==================== GAME RESET ====================
        function resetGameState() {
            gameState = {
                credits: 100,
                spaceshipCount: 1,
                techLevel: 1,
                rebirthPoints: 0,
                totalCreditsEarned: 100,
                multiplier: 1,
                ships: [
                    {
                        id: 1,
                        upgrades: 0,
                        traderLevel: 1,
                        trading: false,
                        automation: false,
                        intervalId: null
                    }
                ],
                buyAmounts: ['1x', '10x', '15x', '30x', '50x', 'Max'],
                currentBuyIndex: 0,
                theme: 'dark',
                shipLimit: 10,
                totalTrades: 0,
                totalEarnings: 0,
                totalUpgrades: 0,
                lastSaveTime: Date.now(),
                timePlayed: 0,
                employees: {
                    storage: {
                        level: 0,
                        cost: 1000
                    },
                    efficiency: {
                        level: 0,
                        cost: 1500
                    },
                    security: {
                        level: 0,
                        cost: 2000
                    }
                },
                shareCooldown: {
                    lastShareTime: 0,
                    cooldownDuration: 1922
                },
                rebirthCooldown: {
                    lastRebirthTime: 0,
                    cooldownDuration: 604800
                },
                securityProtection: 0,
                version: VERSION,
                language: "en",
                achievements: []
            };
            undoStack = [];
            renderShips();
            updateDisplay();
            saveGame();
        }

        // ==================== GAME-OVER FUNCTIONALITY ====================
        // Call checkGameOver() at appropriate times, e.g., after each trade

        // ==================== LOCALSTORAGE EVENT LISTENER ====================
        window.addEventListener('storage', function(event) {
            if (event.key === 'interstellarTraderSave') {
                loadGame();
            }
        });

        // ==================== BACKUP DATA ====================
        // Periodic backup every 5 minutes
        setInterval(backupLocalStorage, 300000); // 5 minutes

        // ==================== TOUCH SCREEN CONTROLS ====================
        // Ensure that all clickable elements respond to touch events
        // No additional code needed as event listeners are generic

        // ==================== AI AUTO-PLAY MODE ====================
        // Placeholder for AI mode; implement as needed

        // ==================== ACHIEVEMENTS ====================
        // Integrated with triggerAchievement() and updateAchievements()

        // ==================== SAVE CODE EXPORT/IMPORT ====================
        // Implemented with exportSaveCode() and importSaveCode()
        // Add buttons to the settings menu for export/import
        function addSaveCodeButtons() {
            const settingsMenu = document.getElementById('settings-menu');
            if (settingsMenu) {
                const exportButton = document.createElement('button');
                exportButton.classList.add('button');
                exportButton.innerText = "📤 Export Save Code";
                exportButton.onclick = exportSaveCode;
                exportButton.style.marginTop = '10px';
                exportButton.title = "Export your game save as a code";
                exportButton.setAttribute('data-localize', 'exportSaveCode');
                settingsMenu.appendChild(exportButton);

                const importButton = document.createElement('button');
                importButton.classList.add('button');
                importButton.innerText = "📥 Import Save Code";
                importButton.onclick = importSaveCode;
                importButton.style.marginTop = '10px';
                importButton.title = "Import your game save from a code";
                importButton.setAttribute('data-localize', 'importSaveCode');
                settingsMenu.appendChild(importButton);
            }
        }

        // Add localization keys for export/import buttons
        localization["en"]["exportSaveCode"] = "📤 Export Save Code";
        localization["en"]["importSaveCode"] = "📥 Import Save Code";
        localization["es"]["exportSaveCode"] = "📤 Exportar Código de Guardado";
        localization["es"]["importSaveCode"] = "📥 Importar Código de Guardado";
        localization["nl"]["exportSaveCode"] = "📤 Exporteer Save Code";
        localization["nl"]["importSaveCode"] = "📥 Importeer Save Code";
        localization["vi"]["exportSaveCode"] = "📤 Xuất Mã Lưu";
        localization["vi"]["importSaveCode"] = "📥 Nhập Mã Lưu";

        // ==================== INITIALIZE GAME ====================
        function initialize() {
            loadGame();
            updateDisplay();
            addAchievementListeners();
            addSaveCodeButtons();
            // Start time played counter only when tab is active
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    startTimeCounter();
                    resumeMusic();
                } else {
                    stopTimeCounter();
                    pauseMusic();
                }
            });
            startTimeCounter();
            updateRebirthMenu();
            setInterval(updateRebirthMenu, 1000); // Update every second
            playBackgroundMusic();
        }

        // ==================== POP-UP NOTIFICATIONS ====================
        // Utilize the showNotification function for all log events
        function logEvent(message, type = 'info') {
            // Also show pop-up notifications for important events
            if (message.startsWith('✨') || message.startsWith('🏆')) {
                showNotification(message, 'success');
            } else if (message.startsWith('⚠')) {
                showNotification(message, 'error');
            } else {
                showNotification(message, 'info');
            }

            // Existing event log functionality
            const p = document.createElement('p');
            const timestamp = new Date().toLocaleTimeString();
            if (message.includes("{") && message.includes("}")) {
                // Replace placeholders with actual values if any
                p.innerHTML = `[${timestamp}] ${replacePlaceholders(message)}`;
            } else {
                p.innerText = `[${timestamp}] ${message}`;
            }
            eventLog.appendChild(p);
            
            // Limit to last 100 entries
            if (eventLog.children.length > 100) {
                eventLog.removeChild(eventLog.firstChild);
            }
            
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        // ==================== LOCALIZATION MENU ====================
        // Already implemented with language selector in settings menu

        // ==================== ACHIEVEMENTS ====================
        // Implemented with triggerAchievement() and showAchievementModal()

        // ==================== TOUCH SCREEN CONTROLS ====================
        // Already handled as all clickable elements have event listeners

        // ==================== AUTO-PLAY/AI MODE ====================
        // Placeholder for AI mode; implement as needed

        // ==================== BACKGROUND MUSIC ====================
        // Already handled with play, pause, and resume functions

        // ==================== GAME OVER DETECTION ====================
        // Example trigger after each trade
        function triggerGameOverCheck() {
            checkGameOver();
        }

        // ==================== LOCALSTORAGE EVENT LISTENER ====================
        window.addEventListener('storage', function(event) {
            if (event.key === 'interstellarTraderSave') {
                loadGame();
            }
        });

        // ==================== ACHIEVEMENT MODAL ====================
        // Already implemented with showAchievementModal()

        // ==================== EMERGENCY BACKUP ====================
        // Implement restore from backup if main save fails
        function emergencyBackupRestore() {
            restoreFromBackup();
        }

        // ==================== INIT ====================
        window.onload = initialize;
    </script>

    <!-- Achievement Modal -->
    <div id="achievement-modal" class="modal-menu" aria-hidden="true" role="dialog" aria-labelledby="achievement-modal-title">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAchievementModal()">&times;</span>
            <h3 id="achievement-modal-title" data-localize="achievementTitle">Achievement Unlocked!</h3>
            <p id="achievement-message" data-localize="achievementMessage">You have unlocked a new achievement.</p>
            <button class="button" onclick="closeAchievementModal()" title="Close Achievement" data-localize="closeAchievement">❌ Close</button>
        </div>
    </div>
</body>
</html>
